<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>ch17_Delegates</title>
        <style>:root
{
    --markdown-font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif;
    --markdown-font-size: 14px;
    --markdown-line-height: 1.6;
    --vscode-font-family:"Segoe WPC", "Segoe UI", sans-serif;
    --vscode-font-weight:normal;
    --vscode-font-size:13px;
    --vscode-editor-font-family:Consolas, "Courier New", monospace;
    --vscode-editor-font-weight:normal;
    --vscode-editor-font-size:14px;
    --vscode-foreground:#616161;
    --vscode-errorForeground:#a1260d;
    --vscode-descriptionForeground:#717171;
    --vscode-icon-foreground:#424242;
    --vscode-focusBorder:#0090f1;
    --vscode-textSeparator-foreground:rgba(0, 0, 0, 0.18);
    --vscode-textLink-foreground:#006ab1;
    --vscode-textLink-activeForeground:#006ab1;
    --vscode-textPreformat-foreground:#a31515;
    --vscode-textBlockQuote-background:rgba(127, 127, 127, 0.1);
    --vscode-textBlockQuote-border:rgba(0, 122, 204, 0.5);
    --vscode-textCodeBlock-background:rgba(220, 220, 220, 0.4);
    --vscode-widget-shadow:#a8a8a8;
    --vscode-input-background:#ffffff;
    --vscode-input-foreground:#616161;
    --vscode-inputOption-activeBorder:rgba(0, 122, 204, 0);
    --vscode-inputOption-activeBackground:rgba(0, 144, 241, 0.2);
    --vscode-inputOption-activeForeground:#000000;
    --vscode-input-placeholderForeground:#767676;
    --vscode-inputValidation-infoBackground:#d6ecf2;
    --vscode-inputValidation-infoBorder:#007acc;
    --vscode-inputValidation-warningBackground:#f6f5d2;
    --vscode-inputValidation-warningBorder:#b89500;
    --vscode-inputValidation-errorBackground:#f2dede;
    --vscode-inputValidation-errorBorder:#be1100;
    --vscode-dropdown-background:#ffffff;
    --vscode-dropdown-border:#cecece;
    --vscode-checkbox-background:#ffffff;
    --vscode-checkbox-border:#cecece;
    --vscode-button-foreground:#ffffff;
    --vscode-button-background:#007acc;
    --vscode-button-hoverBackground:#0062a3;
    --vscode-button-secondaryForeground:#ffffff;
    --vscode-button-secondaryBackground:#5f6a79;
    --vscode-button-secondaryHoverBackground:#4c5561;
    --vscode-badge-background:#c4c4c4;
    --vscode-badge-foreground:#333333;
    --vscode-scrollbar-shadow:#dddddd;
    --vscode-scrollbarSlider-background:rgba(100, 100, 100, 0.4);
    --vscode-scrollbarSlider-hoverBackground:rgba(100, 100, 100, 0.7);
    --vscode-scrollbarSlider-activeBackground:rgba(0, 0, 0, 0.6);
    --vscode-progressBar-background:#0e70c0;
    --vscode-editorError-foreground:#e51400;
    --vscode-editorWarning-foreground:#e9a700;
    --vscode-editorInfo-foreground:#75beff;
    --vscode-editorHint-foreground:#6c6c6c;
    --vscode-editor-background:#ffffff;
    --vscode-editor-foreground:#000000;
    --vscode-editorWidget-background:#f3f3f3;
    --vscode-editorWidget-foreground:#616161;
    --vscode-editorWidget-border:#c8c8c8;
    --vscode-quickInput-background:#f3f3f3;
    --vscode-quickInput-foreground:#616161;
    --vscode-quickInputTitle-background:rgba(0, 0, 0, 0.06);
    --vscode-pickerGroup-foreground:#0066bf;
    --vscode-pickerGroup-border:#cccedb;
    --vscode-editor-selectionBackground:#add6ff;
    --vscode-editor-inactiveSelectionBackground:#e5ebf1;
    --vscode-editor-selectionHighlightBackground:rgba(173, 214, 255, 0.5);
    --vscode-editor-findMatchBackground:#a8ac94;
    --vscode-editor-findMatchHighlightBackground:rgba(234, 92, 0, 0.33);
    --vscode-editor-findRangeHighlightBackground:rgba(180, 180, 180, 0.3);
    --vscode-searchEditor-findMatchBackground:rgba(234, 92, 0, 0.22);
    --vscode-editor-hoverHighlightBackground:rgba(173, 214, 255, 0.15);
    --vscode-editorHoverWidget-background:#f3f3f3;
    --vscode-editorHoverWidget-foreground:#616161;
    --vscode-editorHoverWidget-border:#c8c8c8;
    --vscode-editorHoverWidget-statusBarBackground:#e7e7e7;
    --vscode-editorLink-activeForeground:#0000ff;
    --vscode-editorLightBulb-foreground:#ddb100;
    --vscode-editorLightBulbAutoFix-foreground:#007acc;
    --vscode-diffEditor-insertedTextBackground:rgba(155, 185, 85, 0.2);
    --vscode-diffEditor-removedTextBackground:rgba(255, 0, 0, 0.2);
    --vscode-diffEditor-diagonalFill:rgba(34, 34, 34, 0.2);
    --vscode-list-focusBackground:#d6ebff;
    --vscode-list-activeSelectionBackground:#0074e8;
    --vscode-list-activeSelectionForeground:#ffffff;
    --vscode-list-inactiveSelectionBackground:#e4e6f1;
    --vscode-list-hoverBackground:#e8e8e8;
    --vscode-list-dropBackground:#d6ebff;
    --vscode-list-highlightForeground:#0066bf;
    --vscode-list-invalidItemForeground:#b89500;
    --vscode-list-errorForeground:#b01011;
    --vscode-list-warningForeground:#855f00;
    --vscode-listFilterWidget-background:#efc1ad;
    --vscode-listFilterWidget-outline:rgba(0, 0, 0, 0);
    --vscode-listFilterWidget-noMatchesOutline:#be1100;
    --vscode-list-filterMatchBackground:rgba(234, 92, 0, 0.33);
    --vscode-tree-indentGuidesStroke:#a9a9a9;
    --vscode-list-deemphasizedForeground:#8e8e90;
    --vscode-menu-foreground:#616161;
    --vscode-menu-background:#ffffff;
    --vscode-menu-selectionForeground:#ffffff;
    --vscode-menu-selectionBackground:#0074e8;
    --vscode-menu-separatorBackground:#888888;
    --vscode-editor-snippetTabstopHighlightBackground:rgba(10, 50, 100, 0.2);
    --vscode-editor-snippetFinalTabstopHighlightBorder:rgba(10, 50, 100, 0.5);
    --vscode-breadcrumb-foreground:rgba(97, 97, 97, 0.8);
    --vscode-breadcrumb-background:#ffffff;
    --vscode-breadcrumb-focusForeground:#4e4e4e;
    --vscode-breadcrumb-activeSelectionForeground:#4e4e4e;
    --vscode-breadcrumbPicker-background:#f3f3f3;
    --vscode-merge-currentHeaderBackground:rgba(64, 200, 174, 0.5);
    --vscode-merge-currentContentBackground:rgba(64, 200, 174, 0.2);
    --vscode-merge-incomingHeaderBackground:rgba(64, 166, 255, 0.5);
    --vscode-merge-incomingContentBackground:rgba(64, 166, 255, 0.2);
    --vscode-merge-commonHeaderBackground:rgba(96, 96, 96, 0.4);
    --vscode-merge-commonContentBackground:rgba(96, 96, 96, 0.16);
    --vscode-editorOverviewRuler-currentContentForeground:rgba(64, 200, 174, 0.5);
    --vscode-editorOverviewRuler-incomingContentForeground:rgba(64, 166, 255, 0.5);
    --vscode-editorOverviewRuler-commonContentForeground:rgba(96, 96, 96, 0.4);
    --vscode-editorOverviewRuler-findMatchForeground:rgba(209, 134, 22, 0.49);
    --vscode-editorOverviewRuler-selectionHighlightForeground:rgba(160, 160, 160, 0.8);
    --vscode-minimap-findMatchHighlight:#d18616;
    --vscode-minimap-selectionHighlight:#add6ff;
    --vscode-minimap-errorHighlight:rgba(255, 18, 18, 0.7);
    --vscode-minimap-warningHighlight:#e9a700;
    --vscode-minimapSlider-background:rgba(100, 100, 100, 0.2);
    --vscode-minimapSlider-hoverBackground:rgba(100, 100, 100, 0.35);
    --vscode-minimapSlider-activeBackground:rgba(0, 0, 0, 0.3);
    --vscode-problemsErrorIcon-foreground:#e51400;
    --vscode-problemsWarningIcon-foreground:#e9a700;
    --vscode-problemsInfoIcon-foreground:#75beff;
    --vscode-editor-lineHighlightBorder:#eeeeee;
    --vscode-editor-rangeHighlightBackground:rgba(253, 255, 0, 0.2);
    --vscode-editor-symbolHighlightBackground:rgba(234, 92, 0, 0.33);
    --vscode-editorCursor-foreground:#000000;
    --vscode-editorWhitespace-foreground:rgba(51, 51, 51, 0.2);
    --vscode-editorIndentGuide-background:#d3d3d3;
    --vscode-editorIndentGuide-activeBackground:#939393;
    --vscode-editorLineNumber-foreground:#237893;
    --vscode-editorActiveLineNumber-foreground:#0b216f;
    --vscode-editorLineNumber-activeForeground:#0b216f;
    --vscode-editorRuler-foreground:#d3d3d3;
    --vscode-editorCodeLens-foreground:#999999;
    --vscode-editorBracketMatch-background:rgba(0, 100, 0, 0.1);
    --vscode-editorBracketMatch-border:#b9b9b9;
    --vscode-editorOverviewRuler-border:rgba(127, 127, 127, 0.3);
    --vscode-editorGutter-background:#ffffff;
    --vscode-editorUnnecessaryCode-opacity:rgba(0, 0, 0, 0.47);
    --vscode-editorOverviewRuler-rangeHighlightForeground:rgba(0, 122, 204, 0.6);
    --vscode-editorOverviewRuler-errorForeground:rgba(255, 18, 18, 0.7);
    --vscode-editorOverviewRuler-warningForeground:#e9a700;
    --vscode-editorOverviewRuler-infoForeground:#75beff;
    --vscode-editorOverviewRuler-bracketMatchForeground:#a0a0a0;
    --vscode-symbolIcon-arrayForeground:#616161;
    --vscode-symbolIcon-booleanForeground:#616161;
    --vscode-symbolIcon-classForeground:#d67e00;
    --vscode-symbolIcon-colorForeground:#616161;
    --vscode-symbolIcon-constantForeground:#616161;
    --vscode-symbolIcon-constructorForeground:#652d90;
    --vscode-symbolIcon-enumeratorForeground:#d67e00;
    --vscode-symbolIcon-enumeratorMemberForeground:#007acc;
    --vscode-symbolIcon-eventForeground:#d67e00;
    --vscode-symbolIcon-fieldForeground:#007acc;
    --vscode-symbolIcon-fileForeground:#616161;
    --vscode-symbolIcon-folderForeground:#616161;
    --vscode-symbolIcon-functionForeground:#652d90;
    --vscode-symbolIcon-interfaceForeground:#007acc;
    --vscode-symbolIcon-keyForeground:#616161;
    --vscode-symbolIcon-keywordForeground:#616161;
    --vscode-symbolIcon-methodForeground:#652d90;
    --vscode-symbolIcon-moduleForeground:#616161;
    --vscode-symbolIcon-namespaceForeground:#616161;
    --vscode-symbolIcon-nullForeground:#616161;
    --vscode-symbolIcon-numberForeground:#616161;
    --vscode-symbolIcon-objectForeground:#616161;
    --vscode-symbolIcon-operatorForeground:#616161;
    --vscode-symbolIcon-packageForeground:#616161;
    --vscode-symbolIcon-propertyForeground:#616161;
    --vscode-symbolIcon-referenceForeground:#616161;
    --vscode-symbolIcon-snippetForeground:#616161;
    --vscode-symbolIcon-stringForeground:#616161;
    --vscode-symbolIcon-structForeground:#616161;
    --vscode-symbolIcon-textForeground:#616161;
    --vscode-symbolIcon-typeParameterForeground:#616161;
    --vscode-symbolIcon-unitForeground:#616161;
    --vscode-symbolIcon-variableForeground:#007acc;
    --vscode-editor-foldBackground:rgba(173, 214, 255, 0.3);
    --vscode-editorGutter-foldingControlForeground:#424242;
    --vscode-editor-onTypeRenameBackground:rgba(255, 0, 0, 0.3);
    --vscode-editorSuggestWidget-background:#f3f3f3;
    --vscode-editorSuggestWidget-border:#c8c8c8;
    --vscode-editorSuggestWidget-foreground:#000000;
    --vscode-editorSuggestWidget-selectedBackground:#d6ebff;
    --vscode-editorSuggestWidget-highlightForeground:#0066bf;
    --vscode-editor-wordHighlightBackground:rgba(87, 87, 87, 0.25);
    --vscode-editor-wordHighlightStrongBackground:rgba(14, 99, 156, 0.25);
    --vscode-editorOverviewRuler-wordHighlightForeground:rgba(160, 160, 160, 0.8);
    --vscode-editorOverviewRuler-wordHighlightStrongForeground:rgba(192, 160, 192, 0.8);
    --vscode-peekViewTitle-background:#ffffff;
    --vscode-peekViewTitleLabel-foreground:#333333;
    --vscode-peekViewTitleDescription-foreground:rgba(97, 97, 97, 0.9);
    --vscode-peekView-border:#007acc;
    --vscode-peekViewResult-background:#f3f3f3;
    --vscode-peekViewResult-lineForeground:#646465;
    --vscode-peekViewResult-fileForeground:#1e1e1e;
    --vscode-peekViewResult-selectionBackground:rgba(51, 153, 255, 0.2);
    --vscode-peekViewResult-selectionForeground:#6c6c6c;
    --vscode-peekViewEditor-background:#f2f8fc;
    --vscode-peekViewEditorGutter-background:#f2f8fc;
    --vscode-peekViewResult-matchHighlightBackground:rgba(234, 92, 0, 0.3);
    --vscode-peekViewEditor-matchHighlightBackground:rgba(245, 216, 2, 0.87);
    --vscode-editorMarkerNavigationError-background:#e51400;
    --vscode-editorMarkerNavigationWarning-background:#e9a700;
    --vscode-editorMarkerNavigationInfo-background:#75beff;
    --vscode-editorMarkerNavigation-background:#ffffff;
    --vscode-tab-activeBackground:#ffffff;
    --vscode-tab-unfocusedActiveBackground:#ffffff;
    --vscode-tab-inactiveBackground:#ececec;
    --vscode-tab-unfocusedInactiveBackground:#ececec;
    --vscode-tab-activeForeground:#333333;
    --vscode-tab-inactiveForeground:rgba(51, 51, 51, 0.7);
    --vscode-tab-unfocusedActiveForeground:rgba(51, 51, 51, 0.7);
    --vscode-tab-unfocusedInactiveForeground:rgba(51, 51, 51, 0.35);
    --vscode-tab-activeModifiedBorder:#33aaee;
    --vscode-tab-inactiveModifiedBorder:rgba(51, 170, 238, 0.5);
    --vscode-tab-unfocusedActiveModifiedBorder:rgba(51, 170, 238, 0.7);
    --vscode-tab-unfocusedInactiveModifiedBorder:rgba(51, 170, 238, 0.25);
    --vscode-tab-border:#f3f3f3;
    --vscode-editorPane-background:#ffffff;
    --vscode-editorGroupHeader-tabsBackground:#f3f3f3;
    --vscode-editorGroupHeader-noTabsBackground:#ffffff;
    --vscode-editorGroup-border:#e7e7e7;
    --vscode-editorGroup-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-imagePreview-border:rgba(128, 128, 128, 0.35);
    --vscode-panel-background:#ffffff;
    --vscode-panel-border:rgba(128, 128, 128, 0.35);
    --vscode-panelTitle-activeForeground:#424242;
    --vscode-panelTitle-inactiveForeground:rgba(66, 66, 66, 0.75);
    --vscode-panelTitle-activeBorder:#424242;
    --vscode-panelInput-border:#dddddd;
    --vscode-panel-dropBorder:#424242;
    --vscode-panelSection-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-panelSectionHeader-background:rgba(128, 128, 128, 0.2);
    --vscode-panelSection-border:rgba(128, 128, 128, 0.35);
    --vscode-statusBar-foreground:#ffffff;
    --vscode-statusBar-noFolderForeground:#ffffff;
    --vscode-statusBar-background:#007acc;
    --vscode-statusBar-noFolderBackground:#68217a;
    --vscode-statusBarItem-activeBackground:rgba(255, 255, 255, 0.18);
    --vscode-statusBarItem-hoverBackground:rgba(255, 255, 255, 0.12);
    --vscode-statusBarItem-prominentForeground:#ffffff;
    --vscode-statusBarItem-prominentBackground:rgba(0, 0, 0, 0.5);
    --vscode-statusBarItem-prominentHoverBackground:rgba(0, 0, 0, 0.3);
    --vscode-activityBar-background:#2c2c2c;
    --vscode-activityBar-foreground:#ffffff;
    --vscode-activityBar-inactiveForeground:rgba(255, 255, 255, 0.4);
    --vscode-activityBar-activeBorder:#ffffff;
    --vscode-activityBar-dropBorder:#ffffff;
    --vscode-activityBarBadge-background:#007acc;
    --vscode-activityBarBadge-foreground:#ffffff;
    --vscode-statusBarItem-remoteBackground:#16825d;
    --vscode-statusBarItem-remoteForeground:#ffffff;
    --vscode-extensionBadge-remoteBackground:#007acc;
    --vscode-extensionBadge-remoteForeground:#ffffff;
    --vscode-sideBar-background:#f3f3f3;
    --vscode-sideBarTitle-foreground:#6f6f6f;
    --vscode-sideBar-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-sideBarSectionHeader-background:rgba(0, 0, 0, 0);
    --vscode-sideBarSectionHeader-border:rgba(97, 97, 97, 0.19);
    --vscode-titleBar-activeForeground:#333333;
    --vscode-titleBar-inactiveForeground:rgba(51, 51, 51, 0.6);
    --vscode-titleBar-activeBackground:#dddddd;
    --vscode-titleBar-inactiveBackground:rgba(221, 221, 221, 0.6);
    --vscode-menubar-selectionForeground:#333333;
    --vscode-menubar-selectionBackground:rgba(0, 0, 0, 0.1);
    --vscode-notifications-foreground:#616161;
    --vscode-notifications-background:#f3f3f3;
    --vscode-notificationLink-foreground:#006ab1;
    --vscode-notificationCenterHeader-background:#e7e7e7;
    --vscode-notifications-border:#e7e7e7;
    --vscode-notificationsErrorIcon-foreground:#e51400;
    --vscode-notificationsWarningIcon-foreground:#e9a700;
    --vscode-notificationsInfoIcon-foreground:#75beff;
    --vscode-editorGutter-commentRangeForeground:#c5c5c5;
    --vscode-editor-stackFrameHighlightBackground:rgba(255, 255, 102, 0.45);
    --vscode-editor-focusedStackFrameHighlightBackground:rgba(206, 231, 206, 0.45);
    --vscode-terminal-foreground:#333333;
    --vscode-terminal-selectionBackground:rgba(0, 0, 0, 0.25);
    --vscode-terminal-border:rgba(128, 128, 128, 0.35);
    --vscode-statusBar-debuggingBackground:#cc6633;
    --vscode-statusBar-debuggingForeground:#ffffff;
    --vscode-settings-headerForeground:#444444;
    --vscode-settings-modifiedItemIndicator:#66afe0;
    --vscode-settings-dropdownBackground:#ffffff;
    --vscode-settings-dropdownBorder:#cecece;
    --vscode-settings-dropdownListBorder:#c8c8c8;
    --vscode-settings-checkboxBackground:#ffffff;
    --vscode-settings-checkboxBorder:#cecece;
    --vscode-settings-textInputBackground:#ffffff;
    --vscode-settings-textInputForeground:#616161;
    --vscode-settings-textInputBorder:#cecece;
    --vscode-settings-numberInputBackground:#ffffff;
    --vscode-settings-numberInputForeground:#616161;
    --vscode-settings-numberInputBorder:#cecece;
    --vscode-debugExceptionWidget-border:#a31515;
    --vscode-debugExceptionWidget-background:#f1dfde;
    --vscode-editorGutter-modifiedBackground:#66afe0;
    --vscode-editorGutter-addedBackground:#81b88b;
    --vscode-editorGutter-deletedBackground:#ca4b51;
    --vscode-minimapGutter-modifiedBackground:#66afe0;
    --vscode-minimapGutter-addedBackground:#81b88b;
    --vscode-minimapGutter-deletedBackground:#ca4b51;
    --vscode-editorOverviewRuler-modifiedForeground:rgba(102, 175, 224, 0.6);
    --vscode-editorOverviewRuler-addedForeground:rgba(129, 184, 139, 0.6);
    --vscode-editorOverviewRuler-deletedForeground:rgba(202, 75, 81, 0.6);
    --vscode-searchEditor-textInputBorder:#cecece;
    --vscode-debugIcon-breakpointForeground:#e51400;
    --vscode-debugIcon-breakpointDisabledForeground:#848484;
    --vscode-debugIcon-breakpointUnverifiedForeground:#848484;
    --vscode-debugIcon-breakpointCurrentStackframeForeground:#ffcc00;
    --vscode-debugIcon-breakpointStackframeForeground:#89d185;
    --vscode-debugToolBar-background:#f3f3f3;
    --vscode-debugIcon-startForeground:#388a34;
    --vscode-debugIcon-pauseForeground:#007acc;
    --vscode-debugIcon-stopForeground:#a1260d;
    --vscode-debugIcon-disconnectForeground:#a1260d;
    --vscode-debugIcon-restartForeground:#388a34;
    --vscode-debugIcon-stepOverForeground:#007acc;
    --vscode-debugIcon-stepIntoForeground:#007acc;
    --vscode-debugIcon-stepOutForeground:#007acc;
    --vscode-debugIcon-continueForeground:#007acc;
    --vscode-debugIcon-stepBackForeground:#007acc;
    --vscode-debugTokenExpression-name:#9b46b0;
    --vscode-debugTokenExpression-value:rgba(108, 108, 108, 0.8);
    --vscode-debugTokenExpression-string:#a31515;
    --vscode-debugTokenExpression-boolean:#0000ff;
    --vscode-debugTokenExpression-number:#098658;
    --vscode-debugTokenExpression-error:#e51400;
    --vscode-debugView-exceptionLabelForeground:#ffffff;
    --vscode-debugView-exceptionLabelBackground:#a31515;
    --vscode-debugView-stateLabelForeground:#616161;
    --vscode-debugView-stateLabelBackground:rgba(136, 136, 136, 0.27);
    --vscode-debugView-valueChangedHighlight:#569cd6;
    --vscode-debugConsole-infoForeground:#75beff;
    --vscode-debugConsole-warningForeground:#e9a700;
    --vscode-debugConsole-errorForeground:#a1260d;
    --vscode-debugConsole-sourceForeground:#616161;
    --vscode-debugConsoleInputIcon-foreground:#616161;
    --vscode-extensionButton-prominentBackground:#327e36;
    --vscode-extensionButton-prominentForeground:#ffffff;
    --vscode-extensionButton-prominentHoverBackground:#28632b;
    --vscode-notebook-cellBorderColor:#dae3e9;
    --vscode-notebook-focusedEditorBorder:#0090f1;
    --vscode-notebookStatusSuccessIcon-foreground:#388a34;
    --vscode-notebookStatusErrorIcon-foreground:#a1260d;
    --vscode-notebookStatusRunningIcon-foreground:#616161;
    --vscode-notebook-outputContainerBackgroundColor:rgba(200, 221, 241, 0.31);
    --vscode-notebook-cellToolbarSeparator:rgba(128, 128, 128, 0.35);
    --vscode-notebook-focusedCellBackground:rgba(200, 221, 241, 0.31);
    --vscode-notebook-cellHoverBackground:rgba(200, 221, 241, 0.22);
    --vscode-notebook-focusedCellBorder:rgba(0, 0, 0, 0.12);
    --vscode-notebook-cellStatusBarItemHoverBackground:rgba(0, 0, 0, 0.08);
    --vscode-notebook-cellInsertionIndicator:#0090f1;
    --vscode-notebookScrollbarSlider-background:rgba(100, 100, 100, 0.4);
    --vscode-notebookScrollbarSlider-hoverBackground:rgba(100, 100, 100, 0.7);
    --vscode-notebookScrollbarSlider-activeBackground:rgba(0, 0, 0, 0.6);
    --vscode-notebook-symbolHighlightBackground:rgba(253, 255, 0, 0.2);
    --vscode-scm-providerBorder:#c8c8c8;
    --vscode-terminal-ansiBlack:#000000;
    --vscode-terminal-ansiRed:#cd3131;
    --vscode-terminal-ansiGreen:#00bc00;
    --vscode-terminal-ansiYellow:#949800;
    --vscode-terminal-ansiBlue:#0451a5;
    --vscode-terminal-ansiMagenta:#bc05bc;
    --vscode-terminal-ansiCyan:#0598bc;
    --vscode-terminal-ansiWhite:#555555;
    --vscode-terminal-ansiBrightBlack:#666666;
    --vscode-terminal-ansiBrightRed:#cd3131;
    --vscode-terminal-ansiBrightGreen:#14ce14;
    --vscode-terminal-ansiBrightYellow:#b5ba00;
    --vscode-terminal-ansiBrightBlue:#0451a5;
    --vscode-terminal-ansiBrightMagenta:#bc05bc;
    --vscode-terminal-ansiBrightCyan:#0598bc;
    --vscode-terminal-ansiBrightWhite:#a5a5a5;
    --vscode-gitDecoration-addedResourceForeground:#587c0c;
    --vscode-gitDecoration-modifiedResourceForeground:#895503;
    --vscode-gitDecoration-deletedResourceForeground:#ad0707;
    --vscode-gitDecoration-untrackedResourceForeground:#007100;
    --vscode-gitDecoration-ignoredResourceForeground:#8e8e90;
    --vscode-gitDecoration-conflictingResourceForeground:#6c6cc4;
    --vscode-gitDecoration-submoduleResourceForeground:#1258a7;
    --vscode-gitlens-gutterBackgroundColor:rgba(0, 0, 0, 0.05);
    --vscode-gitlens-gutterForegroundColor:#747474;
    --vscode-gitlens-gutterUncommittedForegroundColor:rgba(0, 188, 242, 0.6);
    --vscode-gitlens-trailingLineBackgroundColor:rgba(0, 0, 0, 0);
    --vscode-gitlens-trailingLineForegroundColor:rgba(153, 153, 153, 0.35);
    --vscode-gitlens-lineHighlightBackgroundColor:rgba(0, 188, 242, 0.2);
    --vscode-gitlens-lineHighlightOverviewRulerColor:rgba(0, 188, 242, 0.6);
    --vscode-issues-newIssueDecoration:rgba(0, 0, 0, 0.28);
}

body
{
    background-color: var(--vscode-editor-background);
    color: var(--vscode-editor-foreground);
    font-family: var(--vscode-font-family);
    font-weight: var(--vscode-font-weight);
    font-size: var(--vscode-font-size);
    margin: 0;
    padding: 0 20px;
}

img
{
    max-width: 100%;
    max-height: 100%;
}

a
{
    color: var(--vscode-textLink-foreground);
}

a:hover
{
    color: var(--vscode-textLink-activeForeground);
}

a:focus,
input:focus,
select:focus,
textarea:focus
{
    outline: 1px solid -webkit-focus-ring-color;
    outline-offset: -1px;
}

code
{
    color: var(--vscode-textPreformat-foreground);
}

blockquote
{
    background: var(--vscode-textBlockQuote-background);
    border-color: var(--vscode-textBlockQuote-border);
}

kbd
{
    color: var(--vscode-editor-foreground);
    border-radius: 3px;
    vertical-align: middle;
    padding: 1px 3px;

    background-color: hsla(0,0%,50%,.17);
    border: 1px solid rgba(71,71,71,.4);
    border-bottom-color: rgba(88,88,88,.4);
    box-shadow: inset 0 -1px 0 rgba(88,88,88,.4);
}

.vscode-light kbd
{
    background-color: hsla(0,0%,87%,.5);
    border: 1px solid hsla(0,0%,80%,.7);
    border-bottom-color: hsla(0,0%,73%,.7);
    box-shadow: inset 0 -1px 0 hsla(0,0%,73%,.7);
}

::-webkit-scrollbar
{
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-corner
{
    background-color: var(--vscode-editor-background);
}

::-webkit-scrollbar-thumb
{
    background-color: var(--vscode-scrollbarSlider-background);
}
::-webkit-scrollbar-thumb:hover
{
    background-color: var(--vscode-scrollbarSlider-hoverBackground);
}
::-webkit-scrollbar-thumb:active
{
    background-color: var(--vscode-scrollbarSlider-activeBackground);
}

.emoji
{
    height: 20px;
}

pre
{
    white-space: pre-wrap;
}

.page-break
{
    display: block;
    page-break-after: always;
}

.no-page-break
{
    page-break-inside: avoid;
}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

html, body {
	font-family: var(--markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--markdown-line-height, 22px);
	word-wrap: break-word;
	overscroll-behavior-x: none;
}

body {
	padding-top: 1em;
}

/* Reset margin top for elements */
h1, h2, h3, h4, h5, h6,
p, ol, ul, pre {
	margin-top: 0;
}

h1, h2, h3, h4, h5, h6 {
	font-weight: 600;
	margin-top: 24px;
	margin-bottom: 16px;
	line-height: 1.25;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection :not(tr,ul,ol).code-active-line:before,
body.showEditorSelection :not(tr,ul,ol).code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

.vscode-high-contrast.showEditorSelection  :not(tr,ul,ol).code-line .code-line:hover:before {
	border-left: none;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

/* Prevent `sub` and `sup` elements from affecting line height */
sub,
sup {
	line-height: 0;
}

ul ul,
ul ol,
ol ul,
ol ol {
	margin-bottom: 0;
}

img, video {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

p {
	margin-bottom: 16px;
}

ul,
ol {
	margin-bottom: 0.7em;
}

hr {
	border: 0;
	height: 1px;
	border-bottom: 1px solid;
}

h1 {
	font-size: 2em;
	margin-top: 0;
	padding-bottom: 0.3em;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h2 {
	font-size: 1.5em;
	padding-bottom: 0.3em;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h3 {
	font-size: 1.25em;
}

h4 {
	font-size: 1em;
}

h5 {
	font-size: 0.875em;
}

h6 {
	font-size: 0.85em;
}

table {
	border-collapse: collapse;
	margin-bottom: 0.7em;
}

th {
	text-align: left;
	border-bottom: 1px solid;
}

th,
td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: var(--vscode-editor-font-family, "SF Mono", Monaco, Menlo, Consolas, "Ubuntu Mono", "Liberation Mono", "DejaVu Sans Mono", "Courier New", monospace);
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

pre {
	background-color: var(--vscode-textCodeBlock-background);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light h2,
.vscode-light hr,
.vscode-light td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark h2,
.vscode-dark hr,
.vscode-dark td {
	border-color: rgba(255, 255, 255, 0.18);
}
</style>
<style>/*
https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs2015.css
*/
/*
 * Visual Studio 2015 dark style
 * Author: Nicolas LLOBERA <nllobera@gmail.com>
 */


.hljs-keyword,
.hljs-literal,
.hljs-symbol,
.hljs-name {
	color: #569CD6;
}
.hljs-link {
	color: #569CD6;
	text-decoration: underline;
}

.hljs-built_in,
.hljs-type {
	color: #4EC9B0;
}

.hljs-number,
.hljs-class {
	color: #B8D7A3;
}

.hljs-string,
.hljs-meta-string {
	color: #D69D85;
}

.hljs-regexp,
.hljs-template-tag {
	color: #9A5334;
}

.hljs-subst,
.hljs-function,
.hljs-title,
.hljs-params,
.hljs-formula {
	color: #DCDCDC;
}

.hljs-comment,
.hljs-quote {
	color: #57A64A;
	font-style: italic;
}

.hljs-doctag {
	color: #608B4E;
}

.hljs-meta,
.hljs-meta-keyword,
.hljs-tag {
	color: #9B9B9B;
}

.hljs-variable,
.hljs-template-variable {
	color: #BD63C5;
}

.hljs-attr,
.hljs-attribute,
.hljs-builtin-name {
	color: #9CDCFE;
}

.hljs-section {
	color: gold;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}

/*.hljs-code {
	font-family:'Monospace';
}*/

.hljs-bullet,
.hljs-selector-tag,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo {
	color: #D7BA7D;
}

.hljs-addition {
	background-color: var(--vscode-diffEditor-insertedTextBackground, rgba(155, 185, 85, 0.2));
	color: rgb(155, 185, 85);
	display: inline-block;
	width: 100%;
}

.hljs-deletion {
	background: var(--vscode-diffEditor-removedTextBackground, rgba(255, 0, 0, 0.2));
	color: rgb(255, 0, 0);
	display: inline-block;
	width: 100%;
}


/*
From https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs.css
*/
/*

Visual Studio-like style based on original C# coloring by Jason Diamond <jason@diamond.name>

*/

.vscode-light .hljs-function,
.vscode-light .hljs-params,
.vscode-light .hljs-number,
.vscode-light .hljs-class  {
	color: inherit;
}

.vscode-light .hljs-comment,
.vscode-light .hljs-quote,
.vscode-light .hljs-number,
.vscode-light .hljs-class,
.vscode-light .hljs-variable {
	color: #008000;
}

.vscode-light .hljs-keyword,
.vscode-light .hljs-selector-tag,
.vscode-light .hljs-name,
.vscode-light .hljs-tag {
	color: #00f;
}

.vscode-light .hljs-built_in,
.vscode-light .hljs-builtin-name {
	color: #007acc;
}

.vscode-light .hljs-string,
.vscode-light .hljs-section,
.vscode-light .hljs-attribute,
.vscode-light .hljs-literal,
.vscode-light .hljs-template-tag,
.vscode-light .hljs-template-variable,
.vscode-light .hljs-type {
	color: #a31515;
}

.vscode-light .hljs-selector-attr,
.vscode-light .hljs-selector-pseudo,
.vscode-light .hljs-meta,
.vscode-light .hljs-meta-keyword {
	color: #2b91af;
}

.vscode-light .hljs-title,
.vscode-light .hljs-doctag {
	color: #808080;
}

.vscode-light .hljs-attr {
	color: #f00;
}

.vscode-light .hljs-symbol,
.vscode-light .hljs-bullet,
.vscode-light .hljs-link {
	color: #00b0e8;
}


.vscode-light .hljs-emphasis {
	font-style: italic;
}

.vscode-light .hljs-strong {
	font-weight: bold;
}
</style>
<style>@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.16.4"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}
</style>
<style>.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}</style>
<style>@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.16.4"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}
</style>

    </head>
    <body class="vscode-body vscode-light">
        <h1 id="第-17-章-委托" tabindex="-1">第 17 章 委托</h1>
<p>本章内容：</p>
<ul>
<li><a href="#17_1">初始委托</a></li>
<li><a href="#17_2">用委托回调静态方法</a></li>
<li><a href="#17_3">用委托回调实例方法</a></li>
<li><a href="#17_4">委托揭秘</a></li>
<li><a href="#17_5">用委托回调许多方法(委托链)</a></li>
<li><a href="#17_6">委托定义不要太多(泛型委托)</a></li>
<li><a href="#17_7">C# 为委托提供的简化语法</a></li>
<li><a href="#17_8">委托和反射</a></li>
</ul>
<p>本章要讨论回调函数。回调函数式一种非常有用的编程机制，它的存在已经有很多年了。Microsoft .NET Framework 通过 <code>委托</code>来提供回调函数机制。不同于其他平台(比如非托管C++)的回调机制，委托的功能要多得多。例如，委托确保回调方法是类型安全的(这是 CLR 最重要的目标之一)。委托还允许顺序调用多个方法，并支持调用静态方法和实例方法。</p>
<h2 id="171-初始委托" tabindex="-1"><a name="17_1">17.1 初始委托</a></h2>
<p>C “运行时”的 <code>qsort</code> 函数获取指向一个回调函数的指针，以便对数组中的元素进行排序。在 Microsoft Windows 中，窗口过程、钩子过程和异步过程调用等都需要回调函数。在 .NET Framework 中，回调方法的应用更是广泛。例如，可以登记回调方法来获得各种各样的通知，例如未处理的异常、窗口状态变化、菜单项选择、文件系统变化、窗体控件事件和异步操作已完成等。</p>
<p>在非托管 C/C++ 中，非成员函数的地址只是一个内存地址。这个地址不携带任何额外的信息，比如函数期望收到的参数个数、参数类型、函数返回值类型以及函数的调用协定。简单地说，非托管 C/C++ 回调函数不是类型安全的(不过它们确实是一种非常轻量级的机制)。</p>
<p>.NET Framework 的回调函数和非托管 Windows 编程环境的回调函数一样有用，一样普遍。但是，.NET Framework 提供了称为<strong>委托</strong>的类型安全机制。为了理解委托，先来看看如何使用它。以下代码<sup>①</sup>演示了如何声明、创建和使用委托：</p>
<blockquote>
<p>① 这个程序最好不要通过在 Visual Studio 中新建 “Windows 窗体应用程序”项目来生成。用文本编辑器输入代码，另存为 <em>name.cs</em>。启动“VS2013 开发人员命令提示”，输入 <code>csc name.cs</code> 生成，输入 <code>name</code> 执行。这样可同时看到控制台和消息框的输出。 —— 译注</p>
</blockquote>
<pre><code class="language-C#"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Windows.Forms;
<span class="hljs-keyword">using</span> System.IO;

<span class="hljs-comment">// 声明一个委托类型，它的实例引用一个方法，</span>
<span class="hljs-comment">// 该方法获取一个 Int32 参数，返回 void</span>
<span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Feedback</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span> {
        StaticDelegateDemo();
        InstanceDelegateDemo();
        ChainDelegateDemo1(<span class="hljs-keyword">new</span> Program());
        ChainDelegateDemo2(<span class="hljs-keyword">new</span> Program());
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">StaticDelegateDemo</span>()</span> {
        Console.WriteLine(<span class="hljs-string">"----- Static Delegate Demo -----"</span>);
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">null</span>);
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> Feedback(Program.FeedbackToConsole));
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> Feedback(FeedbackToMsgBox));          <span class="hljs-comment">// 前缀 "Program." 可选</span>
        Console.WriteLine();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InstanceDelegateDemo</span>()</span> {
        Console.WriteLine(<span class="hljs-string">"----- Instance Delegate Demo -----"</span>);
        Program p = <span class="hljs-keyword">new</span> Program();
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> Feedback(p.FeedbackToFile));
        Console.WriteLine();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ChainDelegateDemo1</span>(<span class="hljs-params">Program p</span>)</span> {
        Console.WriteLine(<span class="hljs-string">"----- Chain Delegate Demo 1 -----"</span>);
        Feedback fb1 = <span class="hljs-keyword">new</span> Feedback(FeedbackToConsole);
        Feedback fb2 = <span class="hljs-keyword">new</span> Feedback(FeedbackToMsgBox);
        Feedback fb3 = <span class="hljs-keyword">new</span> Feedback(p.FeedbackToFile);

        Feedback fbChain = <span class="hljs-literal">null</span>;
        fbChain = (Feedback) Delegate.Combine(fbChain, fb1);
        fbChain = (Feedback) Delegate.Combine(fbChain, fb2);
        fbChain = (Feedback) Delegate.Combine(fbChain, fb3);
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, fbChain);

        Console.WriteLine();
        fbChain = (Feedback)
            Delegate.Remove(fbChain, <span class="hljs-keyword">new</span> Feedback(FeedbackToMsgBox));
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, fbChain);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ChainDelegateDemo2</span>(<span class="hljs-params">Program p</span>)</span> {
        Console.WriteLine(<span class="hljs-string">"----- Chain Delegate Demo 2 -----"</span>);
        Feedback fb1 = <span class="hljs-keyword">new</span> Feedback(FeedbackToConsole);
        Feedback fb2 = <span class="hljs-keyword">new</span> Feedback(FeedbackToMsgBox);
        Feedback fb3 = <span class="hljs-keyword">new</span> Feedback(p.FeedbackToFile);

        Feedback fbChain = <span class="hljs-literal">null</span>;
        fbChain += fb1;
        fbChain += fb2;
        fbChain += fb3;
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, fbChain);

        Console.WriteLine();
        fbChain -= <span class="hljs-keyword">new</span> Feedback(FeedbackToMsgBox);
        Counter(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, fbChain);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Counter</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">from</span>, Int32 to, Feedback fb</span>)</span> {
        <span class="hljs-keyword">for</span> (Int32 val = <span class="hljs-keyword">from</span>; val &lt;= to; val++) {
            <span class="hljs-comment">// 如果指定了任何回调，就调用它们</span>
            <span class="hljs-keyword">if</span> (fb != <span class="hljs-literal">null</span>)
                fb(val);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FeedbackToConsole</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span> {
        Console.WriteLine(<span class="hljs-string">"Item="</span> + <span class="hljs-keyword">value</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FeedbackToMsgBox</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span> {
        MessageBox.Show(<span class="hljs-string">"Item="</span> + <span class="hljs-keyword">value</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FeedbackToFile</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span> {
        <span class="hljs-keyword">using</span> (StreamWriter sw = <span class="hljs-keyword">new</span> StreamWriter(<span class="hljs-string">"Status"</span>, <span class="hljs-literal">true</span>)) {
            sw.WriteLine(<span class="hljs-string">"Item="</span> + <span class="hljs-keyword">value</span>);
        }
    }
}
</code></pre>
<p>下面来看看代码做的事情。在顶部，注意看<code>internal</code>委托<code>Feedback</code>的声明。委托要指定一个回调方法签名。在本例中，<code>Feedback</code>委托指定的方法要获取一个<code>Int32</code>参数，返回<code>void</code>。在某种程度上，委托和非托管 C/C++ 中代表函数地址的<code>typedef</code>很相似。</p>
<p><code>Program</code>类定义了私有静态方法<code>Counter</code>，它从整数<code>from</code>计数到整数<code>to</code>。方法的<code>fb</code>参数代表<code>Feedback</code>委托对象引用。方法遍历所有整数。对于每个整数，如果<code>fb</code>变量不为<code>null</code>，就调用由<code>fb</code>变量指定的回调方法。传入这个回调方法的是正在处理的那个数据项的值，也就是数据项的编号。设计和实现回调方法时，可选择任何恰当的方式处理数据项。</p>
<h2 id="172-用委托回调静态方法" tabindex="-1"><a name="17_2">17.2 用委托回调静态方法</a></h2>
<p>理解<code>Counter</code>方法的设计及其工作方式之后，再来看看如何利用委托回调静态方法。本节重点是上一节示例代码中的<code>StaticDelegateDemo</code>方法。</p>
<p>在<code>StaticDelegateDemo</code>方法中第一次调用<code>Counter</code>方法时，为第三个参数(对应于 <code>Counter</code> 的 <code>fb</code>参数)传递的是<code>null</code>。由于<code>Counter</code>的<code>fb</code>参数收到的是<code>null</code>，所以处理每个数据项时都不调用回调方法。</p>
<p><code>StaticDelegateDemo</code>方法再次调用<code>Counter</code>，为第三个参数传递新构成的<code>Feedback</code>委托对象。委托对象是方法的包装器(wrapper)，使方法能通过包装器来间接回调。在本例中，静态方法的完整名称<code>Program.FeedbackToConsole</code> 被传给 <code>Feedback</code> 委托类型的构造器，这就是要包装的方法。<code>new</code>操作符返回的引用作为<code>Counter</code>的第三个参数来传递。现在，当<code>Counter</code>执行时，会为序列中的每个数据项调用<code>Program</code>类型的静态方法<code>FeedbackToConsole</code>。<code>FeedbackToConsole</code>方法本身的作用很简单，就是向控制台写一个字符串，显示正在进行处理的数据项。</p>
<blockquote>
<p>注意 <code>FeedbackToConsole</code>方法被定义成<code>Program</code>类型内部的私有方法，但<code>Counter</code>方法能调用 <code>Program</code> 的私有方法，这明显没有问题，因为<code>Counter</code>和<code>FeedbackToConsole</code>在同一个类型中定义。但即使<code>Counter</code>方法在另一个类型中定义，也不会出问题！简单地说，在一个类型中通过委托来调用另一个类型的私有成员，只要委托对象是由具有足够安全性/可访问性的代码创建的，便没有问题。</p>
</blockquote>
<p>在 <code>StaticDelegateDemo</code> 方法中，对 <code>Counter</code> 方法的第三个调用和第二个调用几乎完全一致。唯一的区别在于 <code>Feedback</code> 委托对象包装的是静态方法 <code>Program.FeedbackToMsgBox</code>。<code>FeedbackToMsgBox</code>构造一个字符串来指出正在处理的数据项，然后在消息框中显示该字符串。</p>
<p>这个例子中的所有操作都是都是类型安全的。例如，在构造<code>Feedback</code>委托对象时，编译器确保<code>Program</code>的 <code>FeedbackToConsole</code> 和<code>FeedbackToMsgBox</code>方法的签名兼容于<code>Feedback</code>委托定义的签名。具体地说，两个方法都要获取一个参数(一个<code>Int32</code>)，而且两者都要有相同的返回类型(<code>void</code>)。将<code>FeedbackToConsole</code>的定义改为下面这样：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Boolean <span class="hljs-title">FeedbackToConsole</span>(<span class="hljs-params">String <span class="hljs-keyword">value</span></span>)</span> {
    ...
}
</code></pre>
<p>C#编译器将不会编译以上代码，并报告以下错误：<code>error CS0123:"FeedbackToConsole"的重载均与委托Feedback"不匹配</code>。</p>
<p>将方法绑定到委托时，C# 和 CLR 都允许引用类型的<strong>协变性</strong>(covariance)和<strong>逆变性</strong>(contravariance)。协变性是指方法能返回从委托的返回类型派生的一个类型。逆变性是指方法获取的参数可以是委托的参数类型的基类。例如下面这个委托：</p>
<p><code>delegate Object MyCallback(FileStream s);</code></p>
<p>完全可以构造该委托类型的一个实例并绑定具有以下原型的方法：</p>
<p><code>String SomeMethod(Stream s);</code></p>
<p>在这里，<code>SomeMethod</code> 的返回类型(<code>String</code>)派生自委托的返回类型(<code>Object</code>)；这种协变性是允许的。<code>SomeMethod</code>的参数类型(<code>Stream</code>)是委托的参数类型(<code>FileStream</code>)的基类；这种逆变性是允许的。</p>
<p>注意，只有引用类型才支持协变性与逆变性，值类型或<code>void</code>不支持。所以，不能把下面的方法绑定到<code>MyCallback</code>委托：</p>
<p><code>Int32 SomeOtherMethod(Stream s);</code></p>
<p>虽然<code>SomeOtherMethod</code> 的返回类型(<code>Int32</code>)派生自(<code>MyCallback</code>)的返回类型(<code>Object</code>)，但这种形式的协变性是不允许的，因为<code>Int32</code>是值类型。显然，值类型和 <code>void</code> 之所以不支持，是因为它们的存储结构是变化的，而引用类型的存储结构始终是一个指针。幸好，视图执行不支持的操作，C#编译器会报错。</p>
<h2 id="173-用委托回调实例方法" tabindex="-1"><a name="17_3">17.3 用委托回调实例方法</a></h2>
<p>委托除了能调用静态方法，还能为具体的对象调用实例方法。为了理解如何回调实例方法，先来看看 17.1 节的示例代码中的 <code>InstanceDelegateDemo</code> 方法。</p>
<p>注意<code>InstanceDelegateDemo</code>方法构造了名为<code>p</code>的<code>Program</code>对象。这个<code>Program</code>对象没有定义任何实例字段或属性；创建它纯粹是为了演示。在<code>Counter</code>方法调用中构造新的<code>Feedack</code>委托对象时，向<code>Feedback</code> 委托类型的构造函数传递的是<code>p.FeedbackToFile</code>。这导致委托包装对<code>FeedbackToFile</code>方法的引用，这是一个实例方法(而不是静态方法)。当<code>Counter</code>调用由其<code>fb</code>实参标识的回调方法时，会调用<code>FeedbackToFile</code>实例方法，新构造的对象<code>p</code>的地址作为隐式的 <code>this</code>参数传给这个实例方法。</p>
<p><code>FeedbackToFile</code>方法的工作方法类似于<code>FeedbackToConsole</code>和<code>FeedbackToMsgBox</code>，不同的是它会打开一个文件，并将字符串附加到文件末尾。(方法创建的 Status 文件可在与可执行程序相同的目录中找到。)</p>
<p>再次声明，本例旨在演示委托可以包装对实例方法和静态方法的调用。如果是实例方法，委托要知道方法操作的是具体哪个对象实例。包装实例方法很有用，因为对象内部的代码可以访问对象的实例成员。这意味着对象可以维护一些状态，并在回调方法执行期间利用这些状态信息。</p>
<h2 id="174-委托揭秘" tabindex="-1"><a name="17_4">17.4 委托揭秘</a></h2>
<p>从表面看，委托似乎很容易使用：用 C#的<code>delegate</code>关键字定义，用熟悉的<code>new</code>操作符构造委托实例，用熟悉的方法调用语法来调用回调函数(用引用了委托对象的变量替代方法名)。</p>
<p>但实际情况比前几个例子演示的要复杂一些。编译器和 CLR 在幕后做了大量工作来隐藏复杂性。本节要解释编译器和 CLR 如何协同工作来实现委托。掌握这些知识有助于加深对委托的理解，并学会如何更高效地使用。另外，还要介绍通过委托来实现的一些附加功能。</p>
<p>首先重新审视这一行代码：</p>
<p><code>internal delegate void Feedback(Int32 value);</code></p>
<p>看到这行代码后，编译器实际会像下面这样定义一个完整的类：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Feedback</span> : <span class="hljs-title">System.MulticastDelegate</span> {
    <span class="hljs-comment">// 构造器</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Feedback</span>(<span class="hljs-params">Object @<span class="hljs-built_in">object</span>, IntPtr method</span>)</span>;

    <span class="hljs-comment">// 这个方法的原型和源代码指定的一样</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Invoke</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span>;

    <span class="hljs-comment">// 以下方法实现对回调方法的异步问题</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> IAsyncResult <span class="hljs-title">BeginInvoke</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span>, AsyncCallback callback, Object @<span class="hljs-built_in">object</span></span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EndInvoke</span>(<span class="hljs-params">IAsyncResult result</span>)</span>;
}
</code></pre>
<p>编译器定义的类有 4 个方法：一个构造器、<code>Invoke</code>、<code>BeginInvoke</code>和<code>EndInvoke</code>。本章重点解释构造器和<code>Invoke</code>。<code>BeginInvoke</code>和<code>EndInvoke</code>方法将留到第 27 章讨论。</p>
<p>事实上，可用 ILDasm.exe 查看生成的程序集，验证编译器真的会自动生成这个类，如果 17-1 所示。</p>
<p><img src="../resources/images/17_1.png" alt="17_1"></p>
<p>图 17-1 ILDasm.exe 显示了编译器为委托生成的元数据</p>
<p>在本例中，编译器定义了 <code>Feedback</code> 类，它派生自 FCL 定义的<code>System.MulticastDelegate</code> 类型(所有委托类型都派生自<code>MulticastDelegate</code>)。</p>
<blockquote>
<p>重要提示 <code>System.MulticastDelegate</code>派生自<code>System.Delegate</code>，后者又派生自 <code>System.Object</code>。是历史原因造成有两个委托类。这实在是令人遗憾———— FCL 本该只有一个委托类。没有办法，我们对这两个类都要有所了解。即使创建的所有委托类型都将<code>MulticastDelegate</code>作为基类，个别情况下仍会使用 <code>Delegate</code> 类(而非<code>MulticastDelegate</code>类)定义的方法处理自己的委托类型。例如，<code>Delegate</code>类的两个静态方法<code>Combine</code>和<code>Remove</code>(后文将解释其用途)的签名都指出要获取<code>Delegate</code>参数。由于你创建的委托类型派生自<code>MulticastDelegate</code>，后者又派生自<code>Delegate</code>，所以你的委托类型的实例是可以传给这两个方法的。</p>
</blockquote>
<p>这个类的可访问性是<code>private</code>，因为委托在源代码中声明为<code>internal</code>。如果源代码改成使用<code>public</code>可见性，编译器生成的<code>Feedback</code>类也会变成公共类。要注意的是，委托类既可嵌套在一个类型中定义，也可在全局范围中定义。简单地说，由于委托是类，所以凡是能够定义类的地方，都能定义委托。</p>
<p>由于所有委托类型都派生自<code>MulticastDelegate</code>，所以它们继承了<code>MulticastDelegate</code>的字段、属性和方法。在所有这些成员中，有三个非公共字段是最重要的。表 17-1 总结了这些重要字段。</p>
<p>表 17-1 <code>MulticastDelegate</code> 的三个重要的非公共字段</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>_target</code></td>
<td style="text-align:center"><code>System.Object</code></td>
<td style="text-align:center">当委托对象包装一个静态方法时，这个字段为<code>null</code>。当委托对象包装一个实例方法时，这个字段引用的是回调方法要操作的对象。换言之，这个字段指出要传给实例方法的隐式参数 <code>this</code> 的值</td>
</tr>
<tr>
<td style="text-align:center"><code>_methodPtr</code></td>
<td style="text-align:center"><code>System.IntPtr</code></td>
<td style="text-align:center">一个内部的整数值，CLR用它标识要回调的方法</td>
</tr>
<tr>
<td style="text-align:center"><code>_invocationList</code></td>
<td style="text-align:center"><code>System.Object</code></td>
<td style="text-align:center">该字段通常为 <code>null</code>。构造委托链时它引用一个委托数组(详情参见下一节)</td>
</tr>
</tbody>
</table>
<p>注意，所有委托都有一个构造器，它获取两个参数：一个是对象引用，另一个是引用了回调方法的整数。但如果仔细查看前面的源代码，会发现传递的是<code>Program.FeedbackToConsole</code>或<code>p.FeedbackToFile</code>这样的值。根据迄今为止学到的编程知识，似乎没有可能通过编译！</p>
<p>然而，C# 编译器知道要构造的是委托，所以会分析源代码来确定引用的是哪个对象和方法。对象引用被传给构造器的 <code>object</code> 参数，标识了方法的一个特殊 <code>IntPtr</code> 值(从 <code>MethodDef</code> 或 <code>MemberRef</code> 元数据 token 获得)被传给构造器的 <code>method</code> 参数。对于静态方法，会为 <code>object</code> 参数传递 <code>null</code> 值。在构造器内部，这两个实参分别保存在 <code>_target</code> 和 <code>_methodPtr</code> 私有字段中。除此以外，构造器还将 <code>_invocationList</code> 字段设为<code>null</code>，对这个字段的讨论将推迟到 17.5 节 “用委托回调多个方法(委托链)”进行。</p>
<p>所以，每个委托对象实际都是一个包装器，其中包装了一个方法和调用该方法时要操作的对象。例如，在执行以下两行代码之后：</p>
<pre><code class="language-C#">Feedback fbStatic = <span class="hljs-keyword">new</span> Feedback(Program.FeedbackToConsole);
Feedback fbInstance = <span class="hljs-keyword">new</span> Feedback(<span class="hljs-keyword">new</span> Program().FeedbackToFile);
</code></pre>
<p><code>fbStatic</code> 和 <code>fbInstance</code> 变量将引用两个独立的、初始化好的 <code>Feedback</code> 委托对象，，如图 17-2 所示。</p>
<p><img src="../resources/images/17_2.png" alt="17_2"></p>
<p>图 17-2 在两个变量引用的委托中，一个包装静态方法，另一个包装实例方法</p>
<p>知道委托对象如何构造并了解其内部结构之后，再来看看回调方法时如何调用的。为方便讨论，下面重复了 <code>Counter</code> 方法的定义：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Counter</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">from</span>, Int32 to, Feedback fb</span>)</span> {
    <span class="hljs-keyword">for</span> (Int32 val = <span class="hljs-keyword">from</span>; val &lt;= to; val++) {
        <span class="hljs-comment">// 如果指定了任何回调，就调用它们</span>
        <span class="hljs-keyword">if</span> (fb != <span class="hljs-literal">null</span>)
            fb(val);
    }
}
</code></pre>
<p>注意<code>if</code>语句首先检查<code>fb</code>是否为<code>null</code>。不为<code>null</code>就调用<sup>①</sup>回调方法。<code>null</code>检查必不可少，因为<code>fb</code>只是<em>可能</em>引用了<code>Feedback</code>委托对象的变量；它也可能为<code>null</code>。这段代码看上去像是调用了一个名为<code>fb</code>的函数，并向它传递一个参数(<code>val</code>)。但事实上，这里没有名为 <code>fb</code> 的函数。再次提醒你注意注意，因为编译器知道 <code>fb</code> 是引用了委托对象的变量，所以会生成代码调用该委托对象的<code>Invoke</code> 方法。也就是说，编译器在看到以下代码时：</p>
<blockquote>
<p>① 这里的“调用”是 <code>invoke</code>，参考 8.6.2 节的译注对 <code>invoke</code> 和 <code>call</code> 的解释。 ———— 译注</p>
</blockquote>
<p><code>fb(val);</code></p>
<p>它将生成以下代码，好像源代码本来就是这么写的一样：</p>
<p><code>fb.Invoke(val);</code></p>
<p>为了验证编译器生成代码来调用委托类型的 <code>Invoke</code> 方法，可利用 ILDasm.exe 检查为 <code>Counter</code> 方法创建的 IL 代码。下面列出了 <code>Counter</code> 方法的 IL 代码。IL_0009 处的指令就是对 <code>Feedback</code> 的 <code>Invoke</code> 方法的调用。</p>
<pre><code class="language-C#">.<span class="hljs-function">method <span class="hljs-keyword">private</span> hidebysig <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Counter</span>(<span class="hljs-params"> int32 <span class="hljs-keyword">from</span>,
                                               int32 <span class="hljs-string">'to'</span>,
                                               <span class="hljs-keyword">class</span> Feedback fb</span>) cil managed</span>
{
    <span class="hljs-comment">// Code size 23 (0x17)</span>
    .maxstack <span class="hljs-number">2</span>
    .<span class="hljs-function">locals <span class="hljs-title">init</span> (<span class="hljs-params">int32 val</span>)
    IL_0000: ldarg.0
    IL_0001: stloc.0
    IL_0002: br.s IL_0012
    IL_0004: ldarg.2
    IL_0005: brfalse.s IL_000e
    IL_0007: ldarg.2
    IL_0008: ldloc.0
    IL_0009: callvirt instance <span class="hljs-keyword">void</span> Feedback::<span class="hljs-title">Invoke</span>(<span class="hljs-params">int32</span>)
    IL_000e: ldloc.0
    IL_000f: ldc.i4.1
    IL_0010: <span class="hljs-keyword">add</span>
    IL_0011: stloc.0
    IL_0012: ldloc.0
    IL_0013: ldarg.1
    IL_0014: ble.s IL_0004
    IL_0016: ret
} <span class="hljs-comment">// end of method Program::Counter</span>
</span></code></pre>
<p>其实，完全可以修改 <code>Counter</code> 方法来显式调用 <code>Invoke</code> 方法，如下所示：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Counter</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">from</span>, Int32 to, Feedback fb</span>)</span> {
    <span class="hljs-keyword">for</span> (Int32 val = <span class="hljs-keyword">from</span>; val &lt;= to; val++){
        <span class="hljs-comment">// 如果指定了任何回调，就调用它们</span>
        <span class="hljs-keyword">if</span> (fb != <span class="hljs-literal">null</span>)
            fb.Invoke(val);
    }
}
</code></pre>
<p>前面说过，编译器是在定义 <code>Feedback</code> 类的时候定义 <code>Invoke</code> 的。在 <code>Invoke</code> 被调用时，它使用私有字段 <code>_target</code> 和 <code>_methodPtr</code> 在指定对象上调用包装好的回调方法。注意，<code>Invoke</code>方法的签名和委托的签名匹配。由于<code>Feedback</code>委托要获取一个<code>Int32</code>参数并返回<code>void</code>，所以编译器生成的<code>Invoke</code>方法也要获取一个<code>Int32</code>并返回<code>void</code>。</p>
<h2 id="175-用委托回调多个方法委托连" tabindex="-1"><a name="17_5">17.5 用委托回调多个方法(委托连)</a></h2>
<p>委托本身就很有用，再加上对委托链的支持，用处就更大了！委托链是委托对象的集合。可利用委托链调用集合中的委托所代表的全部方法。为了理解这一点，请参考 17.1 节的实例代码中的 <code>ChainDelegateDemo1</code> 方法。在 <code>Console.WriteLine</code> 语句之后，我构造了三个委托对象并让变量 <code>fb1</code>，<code>fb2</code> 和 <code>fb3</code> 分别引用每个对象，如图 17-3 所示。</p>
<p><img src="../resources/images/17_3.png" alt="17_3"><br>
图 17-3 fb1，fb2 和 fb3 变量引用的委托对象的初始状态</p>
<p>指向<code>Feedback</code>委托对象的引用变量<code>fbChain</code>旨在引用委托链(或者说委托对象集合)，这些对象包装了可回调的方法。<code>fbChain</code>初始化为<code>null</code>，表明目前没有要回调的方法。使用<code>Delegate</code>类的公共静态方法<code>Combine</code>将委托添加到链中：</p>
<p><code>fbChain = (Feedback) Delegate.Combine(fbChain, fb1);</code></p>
<p>执行这行代码时，<code>Combine</code> 方法发现试图合并的是<code>null</code>和<code>fb1</code>。在内部，<code>Combine</code>直接返回<code>fb1</code>中的值，所以<code>fbChain</code>变量现在引用<code>fb1</code>变量所引用的委托对象，如果 17-4 所示。</p>
<p><img src="../resources/images/17_4.png" alt="17_4"><br>
图 17-4 在委托链中插入第一个委托后委托对象的状态</p>
<p>再次调用 <code>Combine</code> 方法在链中添加第二个委托：</p>
<p><code>fbChain = (Feedback) Delegate.Combine(fbChain, fb2);</code></p>
<p>在内部，<code>Combine</code>方法发现<code>fbChain</code> 已引用了一个委托对象，所以 <code>Combine</code> 会构造一个新的委托对象。新委托对象对它的私有字段 <code>_target</code> 和 <code>_methodPtr</code> 进行初始化，具体的值对于目前的讨论来说并不重要。重要的是，<code>_invocationList</code>字段被初始化为引用一个委托对象数组。数组的第一个元素(索引0)被初始化引用包装了 <code>FeedbackToConsole</code> 方法的委托(也就是 <code>fbChain</code> 目前引用的委托)。数组的第二个元素(索引 1)被初始化为引用包装了<code>FeedbackToMsgBox</code>方法的委托(也就是 <code>fb2</code> 引用的委托)。最后，<code>fbChain</code>被设为引用新建的委托对象，如果 17-5 所示。</p>
<p><img src="../resources/images/17_5.png" alt="17_5"><br>
图 17-5 在委托链中插入第二个委托之后委托对象的状态</p>
<p>为了在链中添加第三个委托，我再次调用 <code>Combine</code> 方法。</p>
<p><code>fbChain = (Feedback) Delegate.Combine(fbChain, fb3);</code></p>
<p>同样地，<code>Combine</code>方法发现<code>fbChain</code>已引用了一个委托对象，因而又构造一个新的委托对象，如果 17-6 所示。和前面一样，新委托对象对私有字段 <code>_target</code>和<code>_methodPtr</code>进行初始化，具体的值就目前来说并不重要。<code>_invocationList</code>字段被初始化为引用一个委托对象数组。该数组的第一个元素和第二个元素(索引 0 和 1)被初始化为引用 <code>fb1</code> 和 <code>fb2</code> 所引用的委托。数组的第三个元素(索引 2)被初始化为引用包装了<code>FeedbackToFile</code>方法的委托(这是<code>fb3</code>所引用的委托)。最后，<code>fbChain</code>被设为引用这个新建的委托对象。注意，之前新建的委托及其<code>_invocationList</code>字段引用的数组现在可以进行垃圾回收。</p>
<p>在<code>ChainDelegateDemo1</code>方法中，用于设置委托链的所有代码执行完毕之后，我将<code>fbChain</code>变量传给 <code>Counter</code> 方法：</p>
<p><code>Counter(1, 2, fbChain);</code></p>
<p><code>Counter</code>方法内部的代码会在<code>Feedback</code>委托对象上隐式调用<code>Invoke</code>方法，具体已在前面讲述过了。在 <code>fbChain</code>引用的委托上调用<code>Invoke</code>时，该委托发现私有字段<code>_invocationList</code>不为<code>null</code>，所以会执行一个循环来遍历数组中的所有元素，并依次调用每个委托包装的方法。在本例中，<code>FeedbackToConsole</code>首先被调用，随后是<code>FeedbackToMsgBox</code>，最后是<code>FeedbackToFile</code>。</p>
<p><img src="../resources/images/17_6.png" alt="17_6"></p>
<p>图 17-6 委托链完成后委托对象的最终状态</p>
<p>以伪代码的形式，<code>Feedback</code> 的 <code>Invoke</code> 方法基本上是像下面这样实现的：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Invoke</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span> {
    Delegate[] delegateSet = _invocationList <span class="hljs-keyword">as</span> Delegate[];
    <span class="hljs-keyword">if</span> (delegateSet != <span class="hljs-literal">null</span> ) {
        <span class="hljs-comment">// 这个委托数组指定了应该调用的委托</span>
        <span class="hljs-keyword">foreach</span> (Feedback d <span class="hljs-keyword">in</span> delegates)
            d(<span class="hljs-keyword">value</span>);   <span class="hljs-comment">// 调用每个委托</span>
    } <span class="hljs-keyword">else</span> {  <span class="hljs-comment">// 否则就不是委托链</span>
        <span class="hljs-comment">// 该委托标识了要回调的单个方法，</span>
        <span class="hljs-comment">// 在指定的目标对象上调用这个回调方法</span>
        _methodPtr.Invoke(_target, <span class="hljs-keyword">value</span>);
        <span class="hljs-comment">// 上面这行代码接近实际的代码，</span>
        <span class="hljs-comment">// 实际发生的事情用 C# 是表示不出来的</span>
    }
}
</code></pre>
<p>注意，还可调用 <code>Delegate</code> 的公共静态方法 <code>Remove</code> 从链中删除委托。<code>ChainDelegateDemo1</code> 方法在结尾处对此进行了演示。</p>
<p><code>fbChain = (Feedback) Delegate.Remove(fbChain, new Feedback(FeedbackToMsgBox));</code></p>
<p><code>Remove</code> 方法被调用时，它扫描第一个实参(本例是<code>fbChain</code>)所引用的那个委托对象内部维护的委托数组(从末尾向索引 0 扫描)。<code>Remove</code>查找的是其<code>_target</code> 和 <code>_methodPtr</code> 字段与第二个实参(本例是新建的<code>Feedback</code>委托)中的字段匹配的委托。如果找到匹配的委托，并且(在删除之后)数组中只剩余一个数据项，就返回那个数据项。如果找到匹配的委托，并且(在删除之后)数组中只剩余一个数据项，就返回那个数据项。如果找到匹配的委托，并且数组中还剩余多个数据项，就新建一个委托对象————其中创建并初始化的 <code>_invocationList</code> 数组中还剩余多个数据项，当然被删除的数据项除外————并返回对这个新建委托对象的引用。如果从链中删除了仅有的一个元素，<code>Remove</code>会返回<code>null</code>。注意，每次 <code>Remove</code> 方法调用只能从链中删除一个委托，它不会删除有匹配的<code>_target</code> 和 <code>_methodPtr</code> 字段的所有委托。</p>
<p>前面展示的例子中，委托类型 <code>Feedback</code> 的返回值都是 <code>void</code>。但完全可以像下面这样定义 <code>Feedback</code> 委托：</p>
<p><code>public delegate Int32 Feedback(Int32 value);</code></p>
<p>如果是这样定义的，那么该委托的 <code>Invoke</code> 方法就应该像下面这样(又是伪代码形式)：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">public</span> Int32 <span class="hljs-title">Invoke</span>(<span class="hljs-params">Int32 <span class="hljs-keyword">value</span></span>)</span> {
    Int32 result;
    Delegate[] delegateSet = _invocationList <span class="hljs-keyword">as</span> Delegate[];

    <span class="hljs-keyword">if</span>(delegateSet != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 这个委托数组指定了应该调用的委托</span>
        <span class="hljs-keyword">foreach</span> (Feedback d <span class="hljs-keyword">in</span> delegateSet)
            result = d(<span class="hljs-keyword">value</span>);      <span class="hljs-comment">// 调用每个委托</span>
    } <span class="hljs-keyword">else</span> {  <span class="hljs-comment">// 否则就不是委托链</span>
        <span class="hljs-comment">// 该委托标识了要回调的单个方法，</span>
        <span class="hljs-comment">// 在指定的目标对象上调用这个回调方法</span>
        result = _methodPtr.Invoke(_target, <span class="hljs-keyword">value</span>);
        <span class="hljs-comment">// 上面这行代码接近实际的代码</span>
        <span class="hljs-comment">// 实际发生的事情用 C# 是表示不出来的</span>
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>数组中的每个委托被调用时，其返回值被保存到 <code>result</code> 变量中。循环完成后，<code>result</code> 变量只包含调用的最后一个委托的结果(前面的返回值会被丢弃)，该值返回给调用 <code>Invoke</code> 的代码。</p>
<h3 id="1751-c-对委托链的支持" tabindex="-1">17.5.1 C# 对委托链的支持</h3>
<p>为方便 C# 开发人员，C# 编译器自动为委托类型的实例重载了 <code>+=</code> 和 <code>-=</code>操作符。这些操作符分别调用 <code>Delegate.Combine</code> 和 <code>Delegate.Remove</code>。可用这些操作符简化委托链的构造。在 17.1 节的示例代码中，<code>ChainDelegateDemo1</code> 和 <code>ChainDelegateDemo2</code> 方法生成的 IL 代码完全一样。唯一的区别是 <code>ChainDelegateDemo2</code> 方法利用 C# 的<code>+=</code>和<code>-=</code>操作符简化了源代码。</p>
<p>要想证明两个方法生成的 IL 代码一样，可利用 ILDasm.exe 查看生成的 IL 代码。会看到 C#编译器用 <code>Delegate</code> 类型的 <code>Combine</code> 和 <code>Remove</code> 公共静态方法调用分别替换了 <code>+=</code> 和 <code>-=</code> 操作符。</p>
<h3 id="1752-取得对委托链调用的更多控制" tabindex="-1">17.5.2 取得对委托链调用的更多控制</h3>
<p>此时，想必你以已理解了如何创建委托对象链，以及如何调用链中的所有对象。链中的所有项都会被调用，因为委托类型的<code>Invoke</code>方法包含了对数组中的所有项进行遍历的代码。这是一个很简单的算法。尽管这个简单的算法足以应付很多情形，但也有它的局限性。例如，除了最后一个返回值，其他所有回调方法的返回值都会被丢弃。但局限并不止于此。如果被调用的委托中有一个抛出了异常或阻塞了相当长一段时间，会出现什么情况呢？由于这个简单的算法是顺序调用链中的每一个委托，所以一个委托对象出现问题，链中后续的所有对象都调用不了。显然，这个算法还不够健壮。<sup>①</sup></p>
<blockquote>
<p>① 健壮性(鲁棒性)和可靠性是有区别的，两者对应的英文单词分别是 robustness 和 reliability。 健壮性主要描述一个系统对于参数变化的不敏感性，而可靠性主要描述一个系统的正确性，也就是在你固定提供一个参数时，它应该产生稳定的、能预测的输出。例如一个程序，它的设计目标是获取一个参数并输出一个值。假如它能正确完成这个设计目标，就说它是可靠的。但在这个程序执行完毕后，假如没有正确释放内存，或者说系统没有自动帮它释放占用的资源，就认为这个程序及其“运行时”不具备健壮性或者鲁棒性。————译注</p>
</blockquote>
<p>由于这个算法有的时候不胜其任，所以 <code>MulticastDelegate</code> 类提供了一个实例方法 <code>GetInvocationList</code>，用于显式调用链中的每一个委托，并允许你使用需要的任何算法：</p>
<pre><code class="language-C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MulticastDelegate</span> : <span class="hljs-title">Delegate</span> {
    <span class="hljs-comment">// 创建一个委托数组，其中每个元素都引用链中的一个委托</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">override</span> Delegate[] <span class="hljs-title">GetInvocationList</span>()</span>;
}
</code></pre>
<p><code>GetInvocationList</code> 方法操作从 <code>MulticastDelegate</code> 派生的对象，返回包含 <code>Delegate</code> 引用的一个数组，其中每个引用都指向链中的一个委托对象。在内部，<code>GetInvocationList</code> 构造并初始化一个数组，让它的每个元素都引用链中的一个委托，然后返回对该数组的引用。如果<code>_invaocationList</code>字段为<code>null</code>，返回的数组就只有一个元素，该元素引用链中唯一的委托，即委托实例本身。</p>
<p>可以很容易地写一个算法来显式调用数组中每个对象。以下代码进行了演示：</p>
<pre><code class="language-C#"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Reflection;
<span class="hljs-keyword">using</span> System.Text;

<span class="hljs-comment">// 定义一个 Light(灯) 组件</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Light</span> {
    <span class="hljs-comment">// 该方法返回灯的状态</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">SwitchPosition</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"The light is off"</span>;
    }
}

<span class="hljs-comment">// 定义一个 Fan(风扇)组件</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Fan</span> {
    <span class="hljs-comment">// 该方法返回风扇的状态</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">Speed</span>()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"The fan broke due to overheating"</span>);
    }
}

<span class="hljs-comment">// 定义一个 Speaker(扬声器)组件</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Speaker</span> {
    <span class="hljs-comment">// 该方法返回扬声器的状态</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">Volume</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"The volume is loud"</span>;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span> {

    <span class="hljs-comment">// 定义委托来查询一个组件的状态</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">delegate</span> String <span class="hljs-title">GetStatus</span>()</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span> {
        <span class="hljs-comment">// 声明空委托链</span>
        GetStatus getStatus = <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 构造 3 个组件，将它们的状态方法添加到委托链中</span>
        getStatus += <span class="hljs-keyword">new</span> GetStatus(<span class="hljs-keyword">new</span> Light().SwitchPosition);
        getStatus += <span class="hljs-keyword">new</span> GetStatus(<span class="hljs-keyword">new</span> Fan().Speed);
        getStatus += <span class="hljs-keyword">new</span> GetStatus(<span class="hljs-keyword">new</span> Speaker().Volume);

        <span class="hljs-comment">// 显示整理好的状态报告，反映这 3 个组件的状态</span>
        Console.WriteLine(GetComponentStatusReport(getStatus));
    }

    <span class="hljs-comment">// 该方法查询几个组件并返回状态报告</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">GetComponentStatusReport</span>(<span class="hljs-params">GetStatus status</span>)</span> {

        <span class="hljs-comment">// 如果委托链为空，就不进行任何操作</span>
        <span class="hljs-keyword">if</span> (status == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 用下面的变量来创建状态报告</span>
        StringBuilder report = <span class="hljs-keyword">new</span> StringBuilder();

        <span class="hljs-comment">// 获得一个数组，其中每个元素都是链中的委托</span>
        Delegate[] arrayOfDelegates = status.GetInvocationList();

        <span class="hljs-comment">// 遍历数组中的每一个委托</span>
        <span class="hljs-keyword">foreach</span> (GetStatus getStatus <span class="hljs-keyword">in</span> arrayOfDelegates) {

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 获得一个组件的状态字符串，把它附加到报告中</span>
                report.AppendFormat(<span class="hljs-string">"{0}{1}{1}"</span>, getStatus(), Environment.NewLine);
            }
            <span class="hljs-keyword">catch</span> (InvalidOperationException e) {
                <span class="hljs-comment">// 在状态报告为该组件生成一个错误记录</span>
                Object component = getStatus.Target;
                report.AppendFormat(<span class="hljs-string">"Failed to get status from {1}{2}{0}  Error: {3}{0}{0}"</span>, Environment.NewLine,
                    ((component == <span class="hljs-literal">null</span>) ? <span class="hljs-string">""</span> : component.GetType() + <span class="hljs-string">"."</span>),
                    getStatus.Method.Name,
                    e.Message);
            }
        }

        <span class="hljs-comment">// 把整理好的报告返回给调用者</span>
        <span class="hljs-keyword">return</span> report.ToString();
    }
}
</code></pre>
<pre><code class="language-cmd">The light is off

Failed to get status from Fan.Speed
<span class="hljs-function">  Error: <span class="hljs-title">The</span> <span class="hljs-title">fan</span> <span class="hljs-title">broke</span> <span class="hljs-title">due</span> <span class="hljs-title">to</span> <span class="hljs-title">overheating</span>

<span class="hljs-title">The</span> <span class="hljs-title">volume</span> <span class="hljs-title">is</span> <span class="hljs-title">loud</span>
</span></code></pre>
<h2 id="176-委托定义不要太多泛型委托" tabindex="-1"><a name="17_6">17.6 委托定义不要太多(泛型委托)</a></h2>
<p>许多年前，Microsoft 在刚开始开发 .NET Framework 的时候引入了委托类型。随着时间的推移，他们定义了许多委托。事实上，现在仅仅在 MSCorLib.dll 中，就有接近 50 个委托类型。下面只列出其中少数几个：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TryCode</span>(<span class="hljs-params">Object userData</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WaitCallback</span>(<span class="hljs-params">Object state</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TimerCallback</span>(<span class="hljs-params">Object state</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ContextCallback</span>(<span class="hljs-params">Object state</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SendOrPostCallback</span>(<span class="hljs-params">Object state</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ParameterizedThreadStart</span>(<span class="hljs-params">Object obj</span>)</span>;
</code></pre>
<p>发现这几个委托的共同点了吗？它们其实都是一样的：这些委托类型的变量所引用的方法都是获取一个 <code>Object</code>，并返回 <code>void</code>。没理由定义这么多委托类型，留一个就可以了！</p>
<p>事实上， .NET Framework 现在支持泛型，所以实际只需几个泛型委托(在 <code>System</code> 命名空间中定义)就能表示需要获取多达 16 个参数的方法：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Action</span>()</span>;   <span class="hljs-comment">// OK，这个不是泛型</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Action</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T obj</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Action</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>&gt;(<span class="hljs-params">T1 arg1, T2 arg2</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Action</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T3</span>&gt;(<span class="hljs-params">T1 arg1, T2 arg2, T3 arg3</span>)</span>;
...
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Action</span>&lt;<span class="hljs-title">T1</span>, ..., <span class="hljs-title">T16</span>&gt;(<span class="hljs-params">T1 arg1, ..., T16 arg16</span>)</span>;
</code></pre>
<p>所以，.NET Framework 现在提供了 17 个 <code>Action</code> 委托，它们从无参数到最多 16 个参数。如需获取 16 个以上的参数，就必须定义自己的委托类型，但这种情况极其罕见。除了 <code>Action</code> 委托，.NET Framework 还提供了 17 个 <code>Func</code> 函数，允许回调方法返回值：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> TResult <span class="hljs-title">Func</span>&lt;<span class="hljs-title">TResult</span>&gt;()</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> TResult <span class="hljs-title">Func</span>&lt;<span class="hljs-title">T</span>, <span class="hljs-title">TResult</span>&gt;(<span class="hljs-params">T1 arg1, T2 arg2</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> TResult <span class="hljs-title">Func</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">TResult</span>&gt;(<span class="hljs-params">T1 arg1, T2 arg2, T3 arg3</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> TResult <span class="hljs-title">Func</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T3</span>, <span class="hljs-title">TResult</span>&gt;(<span class="hljs-params">T1 arg1, T2 arg2, T3 arg3</span>)</span>;
...
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">delegate</span> TResult <span class="hljs-title">Func</span>&lt;<span class="hljs-title">T1</span>,..., <span class="hljs-title">T16</span>, <span class="hljs-title">TResult</span>&gt;(<span class="hljs-params">T1 arg1, ..., T16 arg16</span>)</span>;
</code></pre>
<p>建议尽量使用这些委托类型，而不是在代码中定义更多的委托类型。这样可减少系统中的类型数量，同时简化编码。然而，如需使用<code>ref</code>或<code>out</code>关键字以传引用的方式传递参数，就可能不得不定义自己的委托：</p>
<p><code>delegate void Bar(ref Int32 z);</code></p>
<p>如果委托要通过 C#的 <code>params</code> 关键字获取数量可变的参数，要为委托的任何参数指定默认值，或者要对委托的泛型类型参数进行约束，也必须定义自己的委托类型。</p>
<p>获取泛型实参并返回值的委托支持逆变和协变，而且建议总是利用这些功能，因为它们没有副作用，而且使你的委托适用于更多情形。欲知逆变和协变的详情，请参见 12.5 节“委托和接口的逆变和协变泛型类型实参”。</p>
<h2 id="177-c为委托提供的简化语法" tabindex="-1"><a name="17_7">17.7 C#为委托提供的简化语法</a></h2>
<p>许多程序员因为语法奇怪而对委托有抗拒感。例如下面这行代码：</p>
<p><code>button1.Cilck += new EventHandler(button1_Click);</code></p>
<p>其中的<code>button1_CLick</code>是方法，看起来像下面这样：</p>
<pre><code class="language-C#"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">button1_Click</span>(<span class="hljs-params">Object sender, EventArgs e</span>)</span> {
    <span class="hljs-comment">// 按钮单击后要做的事情...</span>
}
</code></pre>
<p>第一行代码的思路是向按钮控件登记 <code>button1_Click</code> 方法的地址，以便在按钮被单击时调用方法。许多程序员认为，仅仅为了指定 <code>button1_Click</code> 方法的地址，就构造一个<code>EventHandler</code> 委托对象，这显得有点儿不可思议。然而，构造 <code>EventHandler</code> 委托对象是 CLR 要求的，因为这个对象提供了一个包装器，可确保(被包装的)方法只能以类型安全的方式调用。这个包装器还支持调用实例方法和委托链。遗憾的是，很多程序员并不想仔细研究这些细节。程序员更喜欢像下面这样写代码：</p>
<p><code>button1.Click += button1_Click;</code></p>
<p>幸好，Microsoft C# 编译器确实为程序员提供了用于处理委托的一些简化语法。本节将讨论所有这些简化语法。本节将讨论所有这些简化语法。但开始之前我要声明一点，后文描述的基本上只是 C# 的 <strong>语法糖</strong><sup>①</sup>，这些简化语法为程序员提供了一种更简单的方式生成 CLR 和其他编程语言处理委托时所必须的 IL 代码。这些简化语法是 C# 特有的，其他编译器可能还没有提供额外的委托简化语法。</p>
<blockquote>
<p>① 一般而言，越是高级的语言，提供的简化语法越多，以方便写程序，这就是所谓的 “语法糖”。————译注</p>
</blockquote>
<h3 id="1771-简化语法-1-不需要构造委托对象" tabindex="-1">17.7.1 简化语法 1： 不需要构造委托对象</h3>
<p>如前所述，C# 允许指定回调方法的名称，不必构造委托对象包装器。例如：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallbackWithoutNewingADelegateObject</span>()</span> {
        ThreadPool.QueueUserWorkItem(SomeAsyncTask, <span class="hljs-number">5</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SomeAsyncTask</span>(<span class="hljs-params">Object o</span>)</span> {
        Console.WriteLine(o);
    }
}
</code></pre>
<p><code>ThreadPool</code>类的静态<code>QueueUserWorkItem</code>方法期待一个<code>WaitCallback</code>委托对象引用，委托对象中包装的是对<code>SomeAsyncTask</code>方法的引用。由于 C#编译器能自己进行推断，所以可以省略构造<code>WaitCallback</code>委托对象的代码，使代码的可读性更佳，也更容易理解。当然，当代码编译时，C# 编译器还是会生成 IL 代码来新建 <code>WaitCallback</code> 委托对象———— 只是语法得到了简化而已。</p>
<h3 id="1772-简化语法2不需要定义回调方法lambda-表达式" tabindex="-1">17.7.2 简化语法2：不需要定义回调方法(lambda 表达式)</h3>
<p>在前面的代码中，回调方法名称 <code>SomeAsyncTask</code> 传给 <code>ThreadPool</code> 的 <code>QueueUserWorkItem</code> 方法。C# 允许以内联(直接嵌入)的方式写回调方法的代码，不必在它自己的方法中写。例如，前面的代码可以这样重写：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallbackWithoutNewingADelegateObject</span>()</span> {
        ThreadPool.QueueUserWorkItem( obj =&gt; Console.WriteLine(obj), <span class="hljs-number">5</span>);
    }
}
</code></pre>
<p>注意，传给 <code>QueueUserWorkItem</code> 方法的第一个实参是代码(我把它倾斜显示了)！更正式地说，这是一个 C# lambada 表达式，可通过 C# lambda 表达式操作符 =&gt; 来轻松识别。lambda 表达式可在编译器语句会看到一个委托的地方使用。编译器看到这个 lambda 表达式之后，会在类(本例是 <code>AClass</code>)中自定义一个新的私有方法。这个新方法称为<strong>匿名函数</strong>，因为方法名称由编译器自动创建，而且你一般不知道这个名称。<sup>①</sup>但可利用 ILDasm.exe 这样的工具检查编译器生成的代码。写完前面的代码并编译之后，我通过 ILDasm.exe 看到 C# 编译器将该方法命名为 <code>&lt;CallbackWithoutNewingADelegateObject&gt;b__0</code>，它获取一个 <code>Object</code>，返回<code>void</code>。</p>
<blockquote>
<p>① 作者在这里故意区分了匿名函数和匿名方法。一般情况下，两者可以互换着使用。如果非要区分，那么编译器生成的全都是“匿名函数”，这是最开始的叫法。从 C# 2.0 开始引入了“匿名方法”功能，它的作用就是简化生成匿名函数而需要写的代码。在新的 C#版本中(3.0 和以后)，更是建议用 lambda 表达式来进一步简化语法，不再推荐使用 C# 2.0 引入的“匿名方法”。但归根结底，所有这些语法糖都会为了更简单地生成匿名函数。————译注</p>
</blockquote>
<p>编译器选择的方法名以下<code>&lt;</code>符号开头，这是因为在 C# 中，标识符是不能包含<code>&lt;</code>符号的；这就确保了你不会碰巧定义一个编译器自动选择的名称。顺便说一句，虽然 C# 禁止标识符包含<code>&lt;</code>符号，但 CLR 允许，这是为什么不会出错的原因。还要注意，虽然可将方法名作为字符串来传递，通过反射来访问方法，但 C#语言规范指出，编译器生成名称的方法是没有任何保证的。例如，每次编译代码，编译器都可能为方法生成一个不同的名称。</p>
<p>注意C# 编译器向方法应用了 <code>System.Runtime.CompilerServices.CompilerGeneratedAttribute</code>特性，指出该方法由编译器生成，而非程序员写的。<code>=&gt;</code>操作符右侧的代码被放入编译器生成的方法中。</p>
<blockquote>
<p>注意 写 lambda 表达式时没有办法向编译器生成的方法应用定制特性。此外，不能向方法应用任何方法修饰符(比如 <code>unsafe</code>)。但这一般不会有什么问题，因为编译器生成的匿名函数总是私有方法，而且方法要么是静态的，要么是非静态的，具体取决于方法是否访问了任何实例成员。所以，没必要向方法应用<code>public</code>，<code>protected</code>，<code>internal</code>，<code>virtual</code>，<code>sealed</code>，<code>override</code>或<code>abstract</code>之类的修饰符。</p>
</blockquote>
<p>最后，如果写前面的代码并编译，C# 编译器会将这些代码改写为下面这样(注释是我自己添加的)：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-comment">// 创建该私有字段是为了缓存委托对象</span>
    <span class="hljs-comment">// 优点：CallbackWithoutNewingADelegateObject 不会每次调用都新建一个对象</span>
    <span class="hljs-comment">// 缺点：缓存的对象永远不会被垃圾回收</span>
    [<span class="hljs-meta">CompilerGenerated</span>]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> WaitCallback &lt;&gt;<span class="hljs-number">9</span>__CachedAnonymousMethodDelegate1;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallbackWithoutNewingADelegateObject</span>()</span> {
        <span class="hljs-keyword">if</span> (&lt;&gt;<span class="hljs-number">9</span>__CachedAnonymousMethodDelegate1 == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 第一次调用时，创建委托对象，并缓存它</span>
            &lt;&gt;<span class="hljs-number">9</span>__CachedAnonymousMethodDelegate1 = 
                <span class="hljs-keyword">new</span> WaitCallback(&lt;CallbackWithoutNewingADelegateObject&gt;b__0);
        }
        ThreadPool.QueueUserWorkItem(&lt;&gt;<span class="hljs-number">9</span>__CachedAnonymousMethodDelegate1, <span class="hljs-number">5</span>);
    }

    [<span class="hljs-meta">CompilerGenerated</span>]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> &lt;CallbackWithoutNewingADelegateObject&gt;b__0(Object obj) {
        Console.WriteLine(obj);
    }
}
</code></pre>
<p>lambda 表达式必须匹配 <code>WaitCallback</code> 委托：获取一个 <code>Object</code> 并返回 <code>void</code>。但在指定参数名称时，我简单地将<code>obj</code>放在<code>=&gt;</code>操作符的左侧。在<code>=&gt;</code>操作符右侧，<code>Console.WriteLine</code> 碰巧本来就返回 <code>void</code>。然而，如果在这里放一个返回值不为<code>void</code>的表达式，编译器生成的代码会直接忽略返回值，因为编译器生成的方法必须用 <code>void</code> 返回类型来满足 <code>WaitCallback</code> 委托。</p>
<p>另外还要注意，匿名函数被标记为 <code>private</code>，禁止非类型内定义的代码(尽管反射能揭示出方法确实存在)。另外，匿名函数被标记为<code>static</code>，因为代码没有访问任何实例成员(也不能访问，因为 <code>CallbackWithoutNewingADelegateObject</code> 本身是静态方法)。不过，代码可引用类中定义的任何静态字段或静态方法。下面是一个例子：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String sm_name;  <span class="hljs-comment">// 一个静态字段</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallbackWithoutNewingADelegateObject</span>()</span> {
        ThreadPool.QueueUserWorkItem(
            <span class="hljs-comment">// 回调代码可引用静态成员</span>
            obj =&gt; Console.WriteLine(sm_name + <span class="hljs-string">": "</span> + obj), <span class="hljs-number">5</span>);
    }
}
</code></pre>
<p>如果 <code>CallbackWithoutNewingADelegateObject</code> 方法不是静态的，匿名函数的代码就可以包含对实例成员的引用。不包含实例成员引用，编译器仍会生成静态匿名函数，因为它的效率比实例方法高。之所以更高效，是因为不需要额外的<code>this</code>参数。但是，如果匿名函数的代码确实引用了实例成员，编译器就会生成非静态匿名函数：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-keyword">private</span> String m_name;      <span class="hljs-comment">// 一个实例字段</span>

    <span class="hljs-comment">// 一个实例方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallbackWithoutNewingADelegateObject</span>()</span> {
        ThreadPool.QueueUserWorkItem(
            <span class="hljs-comment">// 回调代码可以引用实例成员</span>
            obj =&gt; Console.WriteLine(m_name + <span class="hljs-string">": "</span> + obj), <span class="hljs-number">5</span>);
        )
    }
}
</code></pre>
<p><code>=&gt;</code>操作符左侧供指定传给 lambda 表达式的参数的名称。下例总结了一些规则：</p>
<pre><code class="language-C#"><span class="hljs-comment">// 如果委托不获取任何参数，就使用 ()</span>
Func&lt;String&gt; f = () =&gt; <span class="hljs-string">"Jeff"</span>;

<span class="hljs-comment">// 如果委托获取 1 个或更多参数，编译器可推断类型</span>
Func&lt;Int32, String&gt; f2 = (Int32 n) =&gt; n.ToString();
Func&lt;Int32, Int32, String&gt; f3 = (Int32 n1, Int32 n2) =&gt; (n1 + n2).ToString();

<span class="hljs-comment">// 如果委托获取 1 个或更多参数，编译器可推断类型</span>
Func&lt;Int32, String&gt; f4 = (n) =&gt; n.ToString();
Func&lt;Int32, Int32, String&gt; f5 = (n1, n2) =&gt; (n1 + n2).ToString();

<span class="hljs-comment">// 如果委托获取 1 个参数，可省略(和)</span>
Func&lt;Int32, String&gt; f6 = n =&gt; n.ToString();

<span class="hljs-comment">// 如果委托有 ref/out 参数，必须显式指定 ref/out 和类型</span>
Bar b = (<span class="hljs-keyword">out</span> Int32 n) =&gt; n = <span class="hljs-number">5</span>;
</code></pre>
<p>对于最后一个例子，假定 <code>Bar</code> 的定义如下：</p>
<p><code>delegate void Bar(out Int32 z);</code></p>
<p><code>=&gt;</code>操作符右侧供指定匿名函数主体。通常，主体包含要么简单、要么复杂的表达式，并最终返回非<code>void</code>值。刚才的代码为所有 <code>Func</code> 委托变量赋值的都会返回<code>String</code>的 lambda 表达式。匿名函数主体还经常只由一个语句构成。调用 <code>ThreadPool.QueueUserWorkItem</code> 时就是这种情况，我向它传递了调用 <code>Console.WriteLine</code>(返回 <code>void</code>)的一个 lambda 表达式。</p>
<p>如果主体由两个或多个语句构成，必须用大括号将语句封闭。在用了大括号的情况下，如果委托期待返回值，还必须在主体中添加 <code>return</code> 语句，例如：</p>
<p><code>Func&lt;Int32, Int32, String&gt; f7 = (n1, n2) =&gt; { Int32 sum = n1 + n2; return sum.ToString(); };</code></p>
<blockquote>
<p>重要提示 lambda 表达式的主要优势在于，它从你的源代码中移除了一个“间接层”(a level of indirection)，或者说避免了迂回。正常情况下，必须写一个单独的方法，命名该方法，再在需要委托的地方传递这个方法名。方法名提供了引用代码主体的一种方式，如果要在多个地方引用同一个代码主体，单独写一个方法并命名确实是理想的方案。但如果只需在代码中引用这个主体一次，那么 lambda 表达式允许直接内联那些代码，不必为它分配名称，从而提高了编程效率。</p>
</blockquote>
<blockquote>
<p>注意 C# 2.0 问世时引入了一个称为匿名方法的功能。和 C# 3.0 引入的 lambda 表达式相似，匿名方法描述的也是创建匿名函数的语法。新规范(C#语言规范 7.14 节)建议开发人员使用新的 lambda 表达式语法，而不是使用旧的匿名方法语法，因为 lambda 表达式语法更简洁，代码更容易写、读和维护。当然，Microsoft C# 编译器仍然支持用这两种语法创建匿名函数，以兼容当年为 C# 2.0 写的代码。在本书中，我只解释并使用 lambda 表达式语法。</p>
</blockquote>
<h3 id="1773-简化语法-3局部变量不需要手动包装到类中即可传给回调方法" tabindex="-1">17.7.3 简化语法 3：局部变量不需要手动包装到类中即可传给回调方法</h3>
<p>前面展示了回调代码如何引用类中定义的其他成员。但有时还希望回调代码引用存在于定义方法中的局部参数或变量。下面是一个有趣的例子：</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UsingLocalVariablesInTheCallbackCode</span>(<span class="hljs-params">Int32 numToDo</span>)</span> {
        <span class="hljs-comment">// 一些局部变量</span>
        Int32[] squares = <span class="hljs-keyword">new</span> Int32[numToDo];
        AutoRestEvent done = <span class="hljs-keyword">new</span> AutoRestEvent(<span class="hljs-literal">false</span>);

        <span class="hljs-comment">// 在其他线程上执行一系列任务</span>
        <span class="hljs-keyword">for</span> (Int32 n = <span class="hljs-number">0</span>; n &lt; squares.Length; n++) {
            ThreadPool.QueueUserWorkItem(
                obj =&gt; {
                    Int32 num = (Int32)obj;

                    <span class="hljs-comment">// 该任务通常更耗时</span>
                    squares[num] = num * num;

                    <span class="hljs-comment">// 如果是最后一个任务，就让主线程继续运行</span>
                    <span class="hljs-keyword">if</span> (Interlocked.Decrement(<span class="hljs-keyword">ref</span> numToDo) == <span class="hljs-number">0</span>)
                        done.Set();                        
                }, n);
        }

        <span class="hljs-comment">// 等待其他所有线程结束运行</span>
        done.WaitOne();

        <span class="hljs-comment">// 显示结果</span>
        <span class="hljs-keyword">for</span> (Int32 n = <span class="hljs-number">0</span>; n &lt; squares.Length; n++) {
            Console.WriteLine(<span class="hljs-string">"Index {0}, Square={1}"</span>, n , squares[n]);
        }
    }
}
</code></pre>
<p>这个例子生成地演示了 C# 如何简单地实现一个非常复杂的任务。方法定义了一个参数 <code>numToDo</code> 和两个局部变量 <code>squares</code> 和 <code>done</code>。而且 lambda 表达式的主体引用了这些变量。</p>
<p>现在，想象 lambda 表达式主体中的代码在一个单独的方法中(确实如此，这是 CLR 要求的)。变量的值如何传给这个单独的方法？唯一的办法是定义一个新的辅助类，这个类要为打算传给回调代码的每个值都定义一个字段。此外，回调代码还必须定义成辅助类中的实例方法。然后， <code>UsingLocalVariablesInTheCallbackCode</code> 方法必须构造辅助类的实例，用方法定义的局部变量的值来初始化该实例中的字段。然后，构造绑定到辅助对象/实例方法的委托对象。</p>
<blockquote>
<p>注意 当 lambda 表达式造成编译器生成一个类，而且参数/局部变量被转变成该类的字段后，变量引用的对象的生存期被延长了。正常情况下，在方法找中最后一次使用/局部变量之后，这个参数/局部变量就会“离开作用域”，结束其生命期。但是，将变量转变成字段后，只要包含字段的那个对象不“死”，字段引用的对象也不会“死”。这在大多数应用程序中不是大问题，但有时要注意一下。</p>
</blockquote>
<p>这项工作非常单调乏味，而且容易出错。但理所当然地，它们全部由 C# 自动完成。写前面的代码时，C# 编译器实际是像下面这样重写了代码(注释是我添加的):</p>
<pre><code class="language-C#"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AClass</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UsingLocalVariablesInTheCallbackCode</span>(<span class="hljs-params">Int32 numToDo</span>)</span> {

        <span class="hljs-comment">// 一些局部变量</span>
        WaitCallback callback1 = <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 构造辅助类的实例</span>
        &lt;&gt;c__DisplayClass2 class1 = <span class="hljs-keyword">new</span> &lt;&gt;c__DisplayClass2();

        <span class="hljs-comment">// 初始化辅助类的字段</span>
        class1.numToDo = numToDo;
        class1.squares = <span class="hljs-keyword">new</span> Int32[class1.numToDo];
        class1.done = <span class="hljs-keyword">new</span> AutoResetEvent(<span class="hljs-literal">false</span>);

        <span class="hljs-comment">// 在其他线程上执行一系列任务</span>
        <span class="hljs-keyword">for</span> (Int32 n = <span class="hljs-number">0</span>; n &lt; class1.squares.Length; n++) {
            <span class="hljs-keyword">if</span> (callback1 == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 新建的委托对象绑定到辅助对象及其匿名实例方法</span>
                callback1 = <span class="hljs-keyword">new</span> WaitCallback(
                    class1.&lt;UsingLocalVariablesInTheCallbackCode&gt;b__0);
            }

            ThreadPool.QueueUserWorkItem(callback, n);
        }

        <span class="hljs-comment">// 等待其他所有线程结束运行</span>
        class1.done.WaitOne();

        <span class="hljs-comment">// 显示结果</span>
        <span class="hljs-keyword">for</span> (Int32 n = <span class="hljs-number">0</span>; n &lt; class1.squares.Length; n++) 
            Console.WriteLine(<span class="hljs-string">"Index {0}, Square={1}"</span>, n, class1.squares[n]);
    }

    <span class="hljs-comment">// 为避免冲突，辅助类被指定了一个奇怪的名称，</span>
    <span class="hljs-comment">// 而且被指定为私有的，禁止从 AClass 类外部访问</span>
    [<span class="hljs-meta">CompilerGenerated</span>]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> &lt;&gt;<span class="hljs-title">c__DisplayClass2</span> : <span class="hljs-title">Object</span> {

        <span class="hljs-comment">// 回调代码要使用的每个局部变量都有一个对应的公共字段</span>
        <span class="hljs-keyword">public</span> Int32[] squares;
        <span class="hljs-keyword">public</span> Int32 numToDo;
        <span class="hljs-keyword">public</span> AutoResetEvent done;

        <span class="hljs-comment">// 公共无参构造器</span>
        <span class="hljs-keyword">public</span> &lt;&gt;c__DisplayClass2 { }

        <span class="hljs-comment">// 包含回调代码的公共实例方法</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> &lt;UsingLocalVariablesInTheCallbackCode&gt;b__0(Object obj) {
            Int32 num = (Int32) obj;
            squares[num] = num * num;
            <span class="hljs-keyword">if</span> (Interlocked.Decrement(<span class="hljs-keyword">ref</span> numToDo) == <span class="hljs-number">0</span>)
                done.Set();
        }
    }
}
</code></pre>
<blockquote>
<p>重要提示 毫无疑问，C# 的 lambda 表达式功能很容易被程序员滥用。我开始使用 lambda 表达式时，绝对是花了一些时间来熟悉它的。毕竟，你在一个方法中写的代码实际不在这个方法中。除了有违直觉，还使调试和单步执行变得比较有挑战性。但事实上，Visual Studio 调试器还是非常不错的。我对自己源代码中的 lambda 表达式进行单步测试时，它处理得相当好。</p>
</blockquote>
<blockquote>
<p>我为自己设定了一个规则：如果需要在回到方法中包含 3 行以上的代码，就不使用 lambda 表达式。相反，我会手动写一个方法，并为其分配自己的名称。但如果使用得当，匿名方法确实能显著提高开发人员的效率和代码的可维护性。在以下代码中，使用 lambda 表达式感觉非常自然。没有它们，这样的代码会很难写、读和维护。</p>
</blockquote>
<pre><code class="language-C#"><span class="hljs-comment">// 创建并初始化一个 String 数组</span>
String[] names = { <span class="hljs-string">"Jeff"</span>, <span class="hljs-string">"Kristin"</span>, <span class="hljs-string">"Aidan"</span>, <span class="hljs-string">"Grant"</span> };

<span class="hljs-comment">// 只获取含有小写字母 'a' 的名字</span>
Char charToFind = <span class="hljs-string">'a'</span>;
names = Array.FindAll(names, name =&gt; name.IndexOf(charToFind) &gt;= <span class="hljs-number">0</span>);

<span class="hljs-comment">// 将每个字符串的字符转换为大写</span>
names = Array.ConvertAll(names, name =&gt; name.ToUpper());

<span class="hljs-comment">// 显示结果</span>
Array.ForEach(names, Console.WriteLine);
</code></pre>
<h2 id="178-委托和反射" tabindex="-1"><a name="17_8">17.8 委托和反射</a></h2>
<p>本章到目前为止，使用委托都要求开发人员事先知道回调方法的原型。例如，假如 <code>fb</code> 是引用了一个 <code>Feedback</code> 委托的变量(参见本章 17.1 节的示例程序)，那么为了调用这个委托，代码应该像下面这样写：</p>
<p><code>fb(item);      // item 被定义 Int32</code></p>
<p>可以看出，编码时必须知道回调方法需要多少个参数，以及参数的具体类型。还好，开发人员几乎总是知道这些信息，所以像前面那样写代码是没有问题的。</p>
<p>不过在个别情况下，这些信息在编译时并不知道。第 11 章“事件”讨论 <code>EventSet</code> 类型时曾展示了一个例子。这个例子用字典来维护一组不同的委托类型。在运行时，为了引发事件，要在字典中查找并调用一个委托。但编译时不可能准确地知道要调用哪个委托，哪些参数必须传给委托的回调方法。</p>
<p>幸好 <code>System.Delegate.MethodInfo</code> 提供了一个 <code>CreateDelegate</code> 方法，允许在编译时不知道委托的所有必要信息的前提下创建委托。下面是 <code>MethodInfo</code> 为该方法定义的重载：</p>
<pre><code class="language-C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MethodInfo</span> : <span class="hljs-title">MethodBase</span> {
    <span class="hljs-comment">// 构造包装了一个静态方法的委托</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Delegate <span class="hljs-title">CreateDelegate</span>(<span class="hljs-params">Type delegateType</span>)</span>;

    <span class="hljs-comment">// 构造包装了一个实例方法的委托： target 引用 “this” 实参</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Delegate <span class="hljs-title">CreateDelegate</span>(<span class="hljs-params">Type delegateType, Object target</span>)</span>;
}
</code></pre>
<p>创建好委托后，用 <code>Delegate</code> 的 <code>DynamicInvoke</code> 方法调用它，如下所示：</p>
<pre><code class="language-C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Delegate</span> {
    <span class="hljs-comment">// 调用委托并传递参数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">DynamicInvoke</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> Object[] args</span>)</span>;
}
</code></pre>
<p>使用反射 API(参见第 23 章 “程序集加载和反射”)，首先必须获取引用了回调方法的一个 <code>MethodInfo</code>对象。然后，调用<code>CreateDelegate</code>方法来构造由第一个参数<code>delegateType</code>所标识的<code>Delegate</code>派生类型的对象。如果委托包装了实例方法，还要向<code>CreateDelegate</code>传递一个<code>target</code>参数，指定作为<code>this</code>参数传给实例方法的对象。</p>
<p><code>System.Delegate</code>的<code>DynamicInvoke</code>方法允许调用委托对象的回调方法，传递一组在运行时确定的参数。调用 <code>DynamicInvoke</code>时，它会在内部保证传递的参数与回调方法期望的参数兼容。如果兼容，就调用回调方法：否则抛出<code>ArgumentException</code>异常。<code>DynamicInvoke</code>返回回调方法所返回的对象。</p>
<p>以下代码演示了如何使用<code>CreateDelegate</code>方法和<code>DynamicInvoke</code>方法：</p>
<pre><code class="language-C#">
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Reflection;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Linq;

<span class="hljs-comment">// 下面是一些不同的委托定义</span>
<span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-built_in">delegate</span> Object <span class="hljs-title">TwoInt32s</span>(<span class="hljs-params">Int32 n1, Int32 n2</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">internal</span> <span class="hljs-built_in">delegate</span> Object <span class="hljs-title">OneString</span>(<span class="hljs-params">String s1</span>)</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DelegateReflection</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-keyword">if</span> (args.Length &lt; <span class="hljs-number">2</span>) {
            String usage =
                <span class="hljs-string">@"Usage:"</span> +
                <span class="hljs-string">"{0} delType methodName [Arg1] [Arg2]"</span> +
                <span class="hljs-string">"{0}    where delType must be TwoInt32s or OneString"</span> +
                <span class="hljs-string">"{0}    if delType is TwoInt32s, methodName must be Add or Subtracr"</span> +
                <span class="hljs-string">"{0}    if delType is OneString, methodName must be NumChars or Reverse"</span> +
                <span class="hljs-string">"{0}"</span> +
                <span class="hljs-string">"{0}Examples:"</span> +
                <span class="hljs-string">"{0}    {1} TwoInt32s Add 123 321"</span> +
                <span class="hljs-string">"{0}    {1} TwoInt32s Subtract 123 321"</span> +
                <span class="hljs-string">"{0}    {1} OneString NumChars \"Hello there\""</span> +
                <span class="hljs-string">"{0}    {1} OneString Reverse \"Hello there\""</span>;
            Console.WriteLine(usage, Environment.NewLine);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 将 delType 实参转换为委托类型</span>
        Type delType = Type.GetType(args[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">if</span> (delType == <span class="hljs-literal">null</span>) {
            Console.WriteLine(<span class="hljs-string">"Invalid delType argument: "</span> + args[<span class="hljs-number">0</span>]);
            <span class="hljs-keyword">return</span>;
        }

        Delegate d;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 将 Arg1 实参转换为方法</span>
            MethodInfo mi = <span class="hljs-keyword">typeof</span>(DelegateReflection).GetTypeInfo().GetDeclaredMethod(args[<span class="hljs-number">1</span>]);

            <span class="hljs-comment">// 创建包装了静态方法的委托对象</span>
            d = mi.CreateDelegate(delType);
        }
        <span class="hljs-keyword">catch</span> (ArgumentException) {
            Console.WriteLine(<span class="hljs-string">"Invalid methodName argument: "</span> + args[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 创建一个数组，其中只包含要通过委托对象传给方法的参数</span>
        Object[] callbackArgs = <span class="hljs-keyword">new</span> Object[args.Length - <span class="hljs-number">2</span>];

        <span class="hljs-keyword">if</span> (d.GetType() == <span class="hljs-keyword">typeof</span>(TwoInt32s)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 将 String 类型的参数转换为 Int32 类型的参数</span>
                <span class="hljs-keyword">for</span> (Int32 a = <span class="hljs-number">0</span>; a &lt; args.Length; a++)
                    callbackArgs[a - <span class="hljs-number">2</span>] = Int32.Parse(args[a]);
            }
            <span class="hljs-keyword">catch</span> (FormatException) {
                Console.WriteLine(<span class="hljs-string">"Parameters must be integers."</span>);
                <span class="hljs-keyword">return</span>;
            }
        }

        <span class="hljs-keyword">if</span> (d.GetType() == <span class="hljs-keyword">typeof</span>(OneString)) {
            <span class="hljs-comment">// 只复制 String 参数</span>
            Array.Copy(args, <span class="hljs-number">2</span>, callbackArgs, <span class="hljs-number">0</span>, callbackArgs.Length);
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 调用委托并显示结果</span>
            Object result = d.DynamicInvoke(callbackArgs);
            Console.WriteLine(<span class="hljs-string">"Result = "</span> + result);
        }
        <span class="hljs-keyword">catch</span> (TargetParameterCountException) {
            Console.WriteLine(<span class="hljs-string">"Incorrect number of parameters specified."</span>);
        }
    }

    <span class="hljs-comment">// 这个回调方法获取 2 个 Int32 参数</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">Add</span>(<span class="hljs-params">Int32 n1, Int32 n2</span>)</span> {
        <span class="hljs-keyword">return</span> n1 + n2;
    }

    <span class="hljs-comment">// 这个回调方法获取 2 个 Int32 参数</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">Subtract</span>(<span class="hljs-params">Int32 n1, Int32 n2</span>)</span> {
        <span class="hljs-keyword">return</span> n1 - n2;
    }

    <span class="hljs-comment">// 这个回调方法获取 1 个 String 参数</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">NumChars</span>(<span class="hljs-params">String s1</span>)</span> {
        <span class="hljs-keyword">return</span> s1.Length;
    }

    <span class="hljs-comment">// 这个回调方法获取 1 个 String 参数</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">Reverse</span>(<span class="hljs-params">String s1</span>)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(s1.Reverse().ToArray());
    }
}
</code></pre>

        <script>var Be=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Me=Be((Lt,Ne)=>{var xe="Expected a function",Ae=NaN,Qe="[object Symbol]",Ze=/^\s+|\s+$/g,et=/^[-+]0x[0-9a-f]+$/i,tt=/^0b[01]+$/i,nt=/^0o[0-7]+$/i,rt=parseInt,it=typeof global=="object"&&global&&global.Object===Object&&global,at=typeof self=="object"&&self&&self.Object===Object&&self,ot=it||at||Function("return this")(),st=Object.prototype,lt=st.toString,ct=Math.max,ut=Math.min,ue=function(){return ot.Date.now()};function dt(e,t,n){var r,i,a,s,u,m,d=0,p=!1,b=!1,T=!0;if(typeof e!="function")throw new TypeError(xe);t=Le(t)||0,te(n)&&(p=!!n.leading,b="maxWait"in n,a=b?ct(Le(n.maxWait)||0,t):a,T="trailing"in n?!!n.trailing:T);function E(v){var A=r,_=i;return r=i=void 0,d=v,s=e.apply(_,A),s}function N(v){return d=v,u=setTimeout(L,t),p?E(v):s}function g(v){var A=v-m,_=v-d,h=t-A;return b?ut(h,a-_):h}function S(v){var A=v-m,_=v-d;return m===void 0||A>=t||A<0||b&&_>=a}function L(){var v=ue();if(S(v))return U(v);u=setTimeout(L,g(v))}function U(v){return u=void 0,T&&r?E(v):(r=i=void 0,s)}function R(){u!==void 0&&clearTimeout(u),d=0,r=m=i=u=void 0}function Y(){return u===void 0?s:U(ue())}function I(){var v=ue(),A=S(v);if(r=arguments,i=this,m=v,A){if(u===void 0)return N(m);if(b)return u=setTimeout(L,t),E(m)}return u===void 0&&(u=setTimeout(L,t)),s}return I.cancel=R,I.flush=Y,I}function ft(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new TypeError(xe);return te(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),dt(e,t,{leading:r,maxWait:t,trailing:i})}function te(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function mt(e){return!!e&&typeof e=="object"}function gt(e){return typeof e=="symbol"||mt(e)&&lt.call(e)==Qe}function Le(e){if(typeof e=="number")return e;if(gt(e))return Ae;if(te(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=te(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Ze,"");var n=tt.test(e);return n||nt.test(e)?rt(e.slice(2),n?2:8):et.test(e)?Ae:+e}Ne.exports=ft});var pe="code-line",F=class{constructor(t,n,r){this.element=t;this.line=n;this.codeElement=r;this._detailParentElements=Array.from(Re(t,"DETAILS"))}get isVisible(){return!this._detailParentElements.some(t=>!t.open)}},ae=(()=>{let e,t=-1;return n=>{if(!e||n!==t){t=n,e=[new F(document.body,-1)];for(let r of document.getElementsByClassName(pe)){if(!(r instanceof HTMLElement))continue;let i=+r.getAttribute("data-line");isNaN(i)||(r.tagName==="CODE"&&r.parentElement&&r.parentElement.tagName==="PRE"?e.push(new F(r.parentElement,i,r)):r.tagName==="UL"||r.tagName==="OL"||e.push(new F(r,i)))}}return e}})();function oe(e,t){let n=Math.floor(e),r=ae(t),i=r[0]||null;for(let a of r){if(a.line===n)return{previous:a,next:void 0};if(a.line>n)return{previous:i,next:a};i=a}return{previous:i}}function He(e,t){let n=ae(t).filter(m=>m.isVisible),r=e-window.scrollY,i=-1,a=n.length-1;for(;i+1<a;){let m=Math.floor((i+a)/2),d=W(n[m]);d.top+d.height>=r?a=m:i=m}let s=n[a],u=W(s);return a>=1&&u.top>r?{previous:n[i],next:s}:a>1&&a<n.length&&u.top+u.height>r?{previous:s,next:n[a+1]}:{previous:s}}function W({element:e}){let t=e.getBoundingClientRect(),n=e.querySelector(`.${pe}`);if(n){let r=n.getBoundingClientRect(),i=Math.max(1,r.top-t.top);return{top:t.top,height:i}}return t}function K(e,t,n){if(!n.settings?.scrollPreviewWithEditor)return;if(e<=0){window.scroll(window.scrollX,0);return}let{previous:r,next:i}=oe(e,t);if(!r)return;let a=0,s=W(r),u=s.top;if(i&&i.line!==r.line){let m=(e-r.line)/(i.line-r.line),d=u+s.height,p=i.element.getBoundingClientRect().top-d;a=d+m*p}else{let m=e-Math.floor(e);a=u+s.height*m}a=Math.abs(a)<1?Math.sign(a):a,window.scroll(window.scrollX,Math.max(1,window.scrollY+a))}function se(e,t){let{previous:n,next:r}=He(e,t);if(n){if(n.line<0)return 0;let i=W(n),a=e-window.scrollY-i.top;if(r){let s=a/(W(r).top-i.top);return n.line+s*(r.line-n.line)}else{let s=a/i.height;return n.line+s}}return null}function ve(e,t){return ae(t).find(n=>n.element.id===e)}function*Re(e,t){for(let n=e.parentElement;n;n=n.parentElement)n.tagName===t&&(yield n)}var J=class{onDidChangeTextEditorSelection(t,n){let{previous:r}=oe(t,n);this._update(r&&(r.codeElement||r.element))}_update(t){this._unmarkActiveElement(this._current),this._markActiveElement(t),this._current=t}_unmarkActiveElement(t){t&&t.classList.toggle("code-active-line",!1)}_markActiveElement(t){t&&t.classList.toggle("code-active-line",!0)}};function he(e){document.readyState==="loading"||document.readyState==="uninitialized"?document.addEventListener("DOMContentLoaded",e):e()}var be=(e,t)=>({postMessage(n,r){e.postMessage({type:n,source:t.settings.source,...r})}});function le(e){let t=document.getElementById("vscode-markdown-preview-data");if(t){let n=t.getAttribute(e);if(n)return JSON.parse(n)}throw new Error(`Could not load data for ${e}`)}var Q=class{constructor(){this._settings=le("data-settings")}get settings(){return this._settings}updateSettings(t){this._settings=t}};var ye=11;function ke(e,t){var n=t.attributes,r,i,a,s,u;if(!(t.nodeType===ye||e.nodeType===ye)){for(var m=n.length-1;m>=0;m--)r=n[m],i=r.name,a=r.namespaceURI,s=r.value,a?(i=r.localName||i,u=e.getAttributeNS(a,i),u!==s&&(r.prefix==="xmlns"&&(i=r.name),e.setAttributeNS(a,i,s))):(u=e.getAttribute(i),u!==s&&e.setAttribute(i,s));for(var d=e.attributes,p=d.length-1;p>=0;p--)r=d[p],i=r.name,a=r.namespaceURI,a?(i=r.localName||i,t.hasAttributeNS(a,i)||e.removeAttributeNS(a,i)):t.hasAttribute(i)||e.removeAttribute(i)}}var Z,Ue="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,Fe=!!w&&"content"in w.createElement("template"),We=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function Ve(e){var t=w.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}function je(e){Z||(Z=w.createRange(),Z.selectNode(w.body));var t=Z.createContextualFragment(e);return t.childNodes[0]}function qe(e){var t=w.createElement("body");return t.innerHTML=e,t.childNodes[0]}function Xe(e){return e=e.trim(),Fe?Ve(e):We?je(e):qe(e)}function ee(e,t){var n=e.nodeName,r=t.nodeName,i,a;return n===r?!0:(i=n.charCodeAt(0),a=r.charCodeAt(0),i<=90&&a>=97?n===r.toUpperCase():a<=90&&i>=97?r===n.toUpperCase():!1)}function Ye(e,t){return!t||t===Ue?w.createElement(e):w.createElementNS(t,e)}function ze(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}function ce(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var Te={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();r==="OPTGROUP"&&(n=n.parentNode,r=n&&n.nodeName.toUpperCase()),r==="SELECT"&&!n.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}ce(e,t,"selected")},INPUT:function(e,t){ce(e,t,"checked"),ce(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==n||!n&&i==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n=-1,r=0,i=e.firstChild,a,s;i;)if(s=i.nodeName&&i.nodeName.toUpperCase(),s==="OPTGROUP")a=i,i=a.firstChild;else{if(s==="OPTION"){if(i.hasAttribute("selected")){n=r;break}r++}i=i.nextSibling,!i&&a&&(i=a.nextSibling,a=null)}e.selectedIndex=n}}},V=1,Ge=11,we=3,Ee=8;function B(){}function $e(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Ke(e){return function(n,r,i){if(i||(i={}),typeof r=="string")if(n.nodeName==="#document"||n.nodeName==="HTML"||n.nodeName==="BODY"){var a=r;r=w.createElement("html"),r.innerHTML=a}else r=Xe(r);var s=i.getNodeKey||$e,u=i.onBeforeNodeAdded||B,m=i.onNodeAdded||B,d=i.onBeforeElUpdated||B,p=i.onElUpdated||B,b=i.onBeforeNodeDiscarded||B,T=i.onNodeDiscarded||B,E=i.onBeforeElChildrenUpdated||B,N=i.childrenOnly===!0,g=Object.create(null),S=[];function L(c){S.push(c)}function U(c,l){if(c.nodeType===V)for(var o=c.firstChild;o;){var f=void 0;l&&(f=s(o))?L(f):(T(o),o.firstChild&&U(o,l)),o=o.nextSibling}}function R(c,l,o){b(c)!==!1&&(l&&l.removeChild(c),T(c),U(c,o))}function Y(c){if(c.nodeType===V||c.nodeType===Ge)for(var l=c.firstChild;l;){var o=s(l);o&&(g[o]=l),Y(l),l=l.nextSibling}}Y(n);function I(c){m(c);for(var l=c.firstChild;l;){var o=l.nextSibling,f=s(l);if(f){var x=g[f];x&&ee(l,x)?(l.parentNode.replaceChild(x,l),A(x,l)):I(l)}else I(l);l=o}}function v(c,l,o){for(;l;){var f=l.nextSibling;(o=s(l))?L(o):R(l,c,!0),l=f}}function A(c,l,o){var f=s(l);f&&delete g[f],!(!o&&(d(c,l)===!1||(e(c,l),p(c),E(c,l)===!1)))&&(c.nodeName!=="TEXTAREA"?_(c,l):Te.TEXTAREA(c,l))}function _(c,l){var o=l.firstChild,f=c.firstChild,x,P,k,G,O;e:for(;o;){for(G=o.nextSibling,x=s(o);f;){if(k=f.nextSibling,o.isSameNode&&o.isSameNode(f)){o=G,f=k;continue e}P=s(f);var $=f.nodeType,D=void 0;if($===o.nodeType&&($===V?(x?x!==P&&((O=g[x])?k===O?D=!1:(c.insertBefore(O,f),P?L(P):R(f,c,!0),f=O):D=!1):P&&(D=!1),D=D!==!1&&ee(f,o),D&&A(f,o)):($===we||$==Ee)&&(D=!0,f.nodeValue!==o.nodeValue&&(f.nodeValue=o.nodeValue))),D){o=G,f=k;continue e}P?L(P):R(f,c,!0),f=k}if(x&&(O=g[x])&&ee(O,o))c.appendChild(O),A(O,o);else{var ie=u(o);ie!==!1&&(ie&&(o=ie),o.actualize&&(o=o.actualize(c.ownerDocument||w)),c.appendChild(o),I(o))}o=G,f=k}v(c,f,P);var ge=Te[c.nodeName];ge&&ge(c,l)}var h=n,z=h.nodeType,me=r.nodeType;if(!N){if(z===V)me===V?ee(n,r)||(T(n),h=ze(n,Ye(r.nodeName,r.namespaceURI))):h=r;else if(z===we||z===Ee){if(me===z)return h.nodeValue!==r.nodeValue&&(h.nodeValue=r.nodeValue),h;h=r}}if(h===r)T(n);else{if(r.isSameNode&&r.isSameNode(h))return;if(A(h,r,N),S)for(var ne=0,_e=S.length;ne<_e;ne++){var re=g[S[ne]];re&&R(re,re.parentNode,!1)}}return!N&&h!==n&&n.parentNode&&(h.actualize&&(h=h.actualize(n.ownerDocument||w)),n.parentNode.replaceChild(h,n)),h}}var Je=Ke(ke),Se=Je;var Ce=Me(),H=0,Pe=new J,y=new Q,M=0,j=y.settings.source,q=acquireVsCodeApi(),de=q.getState()??{},C={...de,...le("data-state")};typeof de.scrollProgress<"u"&&de?.resource!==C.resource&&(C.scrollProgress=0);q.setState(C);var X=be(q,y);window.cspAlerter.setPoster(X);window.styleLoadingMonitor.setPoster(X);function fe(e){let t=document.getElementsByTagName("img");if(t.length>0){let n=Array.from(t,r=>r.complete?Promise.resolve():new Promise(i=>{r.addEventListener("load",()=>i()),r.addEventListener("error",()=>i())}));Promise.all(n).then(()=>setTimeout(e,0))}else setTimeout(e,0)}he(()=>{let e=C.scrollProgress;if(Oe(),typeof e=="number"&&!y.settings.fragment){fe(()=>{H+=1;let t=Math.max(1,e*document.body.clientHeight);window.scrollTo(0,t)});return}y.settings.scrollPreviewWithEditor&&fe(()=>{if(y.settings.fragment){let t;try{t=encodeURIComponent(y.settings.fragment)}catch{t=y.settings.fragment}C.fragment=void 0,q.setState(C);let n=ve(t,M);n&&(H+=1,K(n.line,M,y))}else isNaN(y.settings.line)||(H+=1,K(y.settings.line,M,y))}),typeof y.settings.selectedLine=="number"&&Pe.onDidChangeTextEditorSelection(y.settings.selectedLine,M)});var pt=(()=>{let e=Ce(t=>{H+=1,fe(()=>K(t,M,y))},50);return t=>{isNaN(t)||(C.line=t,e(t))}})();window.addEventListener("resize",()=>{H+=1,Ie()},!0);function Oe(){let e=document.getElementsByTagName("img"),t=0;for(let n of e)n.id="image-"+t,t+=1,n.setAttribute("data-vscode-context",JSON.stringify({webviewSection:"image",id:n.id,preventDefaultContextMenuItems:!0,resource:j}))}async function De(e,t=5){if(!document.hasFocus()&&t>0){setTimeout(()=>{De(e,t-1)},20);return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":new Promise(n=>{let r=document.createElement("canvas");r!==null&&(r.width=e.naturalWidth,r.height=e.naturalHeight,r.getContext("2d")?.drawImage(e,0,0)),r.toBlob(i=>{i&&n(i),r.remove()},"image/png")})})])}catch(n){console.error(n)}}window.addEventListener("message",async e=>{let t=e.data;switch(t.type){case"copyImage":{let n=document.getElementById(t.id);n instanceof HTMLImageElement&&De(n);return}case"onDidChangeTextEditorSelection":t.source===j&&Pe.onDidChangeTextEditorSelection(t.line,M);return;case"updateView":t.source===j&&pt(t.line);return;case"updateContent":{let n=document.querySelector(".markdown-body"),i=new DOMParser().parseFromString(t.content,"text/html");for(let a of Array.from(i.querySelectorAll("meta")))a.hasAttribute("http-equiv")&&a.remove();if(t.source!==j)n.replaceWith(i.querySelector(".markdown-body")),j=t.source;else{let a=["open"],s=(d,p)=>{if(d.isEqualNode(p))return!0;if(d.tagName!==p.tagName||d.textContent!==p.textContent)return!1;let b=[...d.attributes].filter(g=>!a.includes(g.name)),T=[...p.attributes].filter(g=>!a.includes(g.name));if(b.length!==T.length)return!1;for(let g=0;g<b.length;++g){let S=b[g],L=T[g];if(S.name!==L.name||S.value!==L.value&&S.name!=="data-line")return!1}let E=Array.from(d.children),N=Array.from(p.children);return E.length===N.length&&E.every((g,S)=>s(g,N[S]))},u=i.querySelector(".markdown-body"),m=u.querySelectorAll("link");for(let d of m)d.remove();u.prepend(...m),Se(n,u,{childrenOnly:!0,onBeforeElUpdated:(d,p)=>{if(s(d,p)){let b=d.querySelectorAll("[data-line]"),T=p.querySelectorAll("[data-line]");b.length!==T.length&&console.log("unexpected line number change");for(let E=0;E<b.length;++E){let N=b[E],g=T[E];g&&N.setAttribute("data-line",g.getAttribute("data-line"))}return!1}return d.tagName==="DETAILS"&&p.tagName==="DETAILS"&&d.hasAttribute("open")&&p.setAttribute("open",""),!0}})}++M,window.dispatchEvent(new CustomEvent("vscode.markdown.updateContent")),Oe();break}}},!1);document.addEventListener("dblclick",e=>{if(!y.settings.doubleClickToSwitchToEditor)return;for(let r=e.target;r;r=r.parentNode)if(r.tagName==="A")return;let t=e.pageY,n=se(t,M);typeof n=="number"&&!isNaN(n)&&X.postMessage("didClick",{line:Math.floor(n)})});var vt=["http:","https:","mailto:","vscode:","vscode-insiders:"];document.addEventListener("click",e=>{if(!e)return;let t=e.target;for(;t;){if(t.tagName&&t.tagName==="A"&&t.href){if(t.getAttribute("href").startsWith("#"))return;let n=t.getAttribute("data-href");if(!n){if(vt.some(r=>t.href.startsWith(r)))return;n=t.getAttribute("href")}if(!/^[a-z\-]+:/i.test(n)){X.postMessage("openLink",{href:n}),e.preventDefault(),e.stopPropagation();return}return}t=t.parentNode}},!0);window.addEventListener("scroll",Ce(()=>{if(Ie(),H>0)H-=1;else{let e=se(window.scrollY,M);typeof e=="number"&&!isNaN(e)&&X.postMessage("revealLine",{line:e})}},50));function Ie(){C.scrollProgress=window.scrollY/document.body.clientHeight,q.setState(C)}
</script>

    </body>
</html>
